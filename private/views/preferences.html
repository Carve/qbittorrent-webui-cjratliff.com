<div id="BehaviorTab" class="PrefTab">
    <fieldset class="settings">
        <legend>Language</legend>
        <label for="locale_select">User interface language:</label>
        <select id="locale_select">
            ${LANGUAGE_OPTIONS}
        </select>
    </fieldset>

    <fieldset class="settings">
        <legend>Transfer list</legend>
        <div class="formRow" style="margin-bottom: 3px;" title="Shows a confirmation dialog upon torrent deletion">
            <input type="checkbox" id="confirmTorrentDeletion">
            <label for="confirmTorrentDeletion">Confirm when deleting torrents</label>
        </div>
        <div class="formRow" style="margin-bottom: 3px;">
            <input type="checkbox" id="useAltRowColorsInput">
            <label for="useAltRowColorsInput">Use alternating row colors</label>
        </div>
        <fieldset class="settings">
            <legend>Action on double-click</legend>
            <table>
                <tbody>
                    <tr>
                        <td><label for="dblclickDownloadSelect">Downloading torrents:</label></td>
                        <td>
                            <select id="dblclickDownloadSelect">
                                <option value="1" selected>Start / stop torrent</option>
                                <option value="0">No action</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label for="dblclickCompleteSelect">Completed torrents:</label></td>
                        <td>
                            <select id="dblclickCompleteSelect">
                                <option value="1" selected>Start / stop torrent</option>
                                <option value="0">No action</option>
                            </select>
                        </td>
                    </tr>
                </tbody>
            </table>
        </fieldset>
        <div class="formRow" style="margin-bottom: 3px;">
            <input type="checkbox" id="hideZeroFiltersCheckbox">
            <label for="hideZeroFiltersCheckbox">Auto hide zero status filters</label>
        </div>
    </fieldset>

    <fieldset class="settings">
        <legend>
            <input type="checkbox" id="filelog_checkbox" onclick="qBittorrent.Preferences.updateFileLogEnabled();">
            <label for="filelog_checkbox">Log Files</label>
        </legend>
        <div class="formRow">
            <label for="filelog_save_path_input">Save path:</label>
            <input type="text" id="filelog_save_path_input" class="pathDirectory">
        </div>
        <table>
            <tbody>
                <tr>
                    <td><input type="checkbox" id="filelog_backup_checkbox" onclick="qBittorrent.Preferences.updateFileLogBackupEnabled();"></td>
                    <td><label id="filelogMaxSizeLabel" for="filelog_backup_checkbox">Backup the log file after:</label></td>
                    <td><input id="filelog_max_size_input" type="number" min="1" max="1024000" value="65" onchange="qBittorrent.Preferences.numberInputLimiter(this);" aria-labelledby="filelogMaxSizeLabel">KiB</td>
                </tr>
                <tr>
                    <td><input type="checkbox" id="filelog_delete_old_checkbox" onclick="qBittorrent.Preferences.updateFileLogDeleteEnabled();"></td>
                    <td><label id="filelogDeleteOldLabel" for="filelog_delete_old_checkbox">Delete backup logs older than:</label></td>
                    <td>
                        <input type="number" min="1" max="365" value="6" id="filelog_age_input" onchange="qBittorrent.Preferences.numberInputLimiter(this);" aria-labelledby="filelogDeleteOldLabel">
                        <select id="filelog_age_type_select" aria-labelledby="filelogDeleteOldLabel">
                            <option value="0">days</option>
                            <option value="1" selected>months</option>
                            <option value="2">years</option>
                        </select>
                    </td>
                </tr>
            </tbody>
        </table>
    </fieldset>

    <div class="formRow" style="margin-bottom: 5px;">
        <input type="checkbox" id="performanceWarning">
        <label for="performanceWarning">Log performance warnings</label>
    </div>

    <fieldset class="settings">
        <legend title="Following settings are WebUI only">Custom WebUI settings</legend>
        <div class="formRow" style="margin-bottom: 3px;">
            <input type="checkbox" id="displayFullURLTrackerColumn">
            <label for="displayFullURLTrackerColumn">Display full announce URL in the Tracker column</label>
        </div>
    </fieldset>
</div>

<div id="DownloadsTab" class="PrefTab invisible">
    <fieldset class="settings">
        <legend>When adding a torrent</legend>
        <div class="formRow">
            <label for="contentlayout_select">Torrent content layout:</label>
            <select id="contentlayout_select">
                <option value="Original">Original</option>
                <option value="Subfolder">Create subfolder</option>
                <option value="NoSubfolder">Don't create subfolder</option>
            </select>
        </div>
        <div class="formRow">
            <input type="checkbox" id="addToTopOfQueueCheckbox">
            <label for="addToTopOfQueueCheckbox">Add to top of queue</label>
        </div>
        <div class="formRow">
            <input type="checkbox" id="dontstartdownloads_checkbox">
            <label for="dontstartdownloads_checkbox">Do not start the download automatically</label>
        </div>
        <div class="formRow">
            <label for="stopConditionSelect">Torrent stop condition:</label>
            <select id="stopConditionSelect">
                <option value="None">None</option>
                <option value="MetadataReceived">Metadata received</option>
                <option value="FilesChecked">Files checked</option>
            </select>
        </div>
        <fieldset class="settings">
            <legend>When duplicate torrent is being added</legend>
            <div class="formRow">
                <input type="checkbox" id="mergeTrackersInput">
                <label for="mergeTrackersInput">Merge trackers to existing torrent</label>
            </div>
        </fieldset>
        <div class="formRow">
            <input type="checkbox" id="deletetorrentfileafter_checkbox">
            <label for="deletetorrentfileafter_checkbox">Delete .torrent files afterwards</label>
        </div>
    </fieldset>

    <div class="formRow">
        <input type="checkbox" id="preallocateall_checkbox">
        <label for="preallocateall_checkbox">Pre-allocate disk space for all files</label>
    </div>
    <div class="formRow">
        <span id="appendexttr">
            <input type="checkbox" id="appendext_checkbox">
            <label for="appendext_checkbox">Append .!qB extension to incomplete files</label>
        </span>
    </div>
    <div class="formRow">
        <span id="unwantedfoldertr">
            <input type="checkbox" id="unwantedfolder_checkbox">
            <label for="unwantedfolder_checkbox">Keep unselected files in ".unwanted" folder</label>
        </span>
    </div>

    <fieldset class="settings">
        <legend>Saving Management</legend>
        <table>
            <tbody>
                <tr>
                    <td>
                        <label for="default_tmm_combobox">Default Torrent Management Mode:</label>
                    </td>
                    <td>
                        <select id="default_tmm_combobox">
                            <option value="false" selected>Manual</option>
                            <option value="true">Automatic</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="torrent_changed_tmm_combobox">When Torrent Category changed:</label>
                    </td>
                    <td>
                        <select id="torrent_changed_tmm_combobox">
                            <option value="true">Relocate torrent</option>
                            <option value="false" selected>Switch torrent to Manual Mode</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="save_path_changed_tmm_combobox">When Default Save Path changed:</label>
                    </td>
                    <td>
                        <select id="save_path_changed_tmm_combobox">
                            <option value="true">Relocate affected torrents</option>
                            <option value="false" selected>Switch affected torrents to Manual Mode</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="category_changed_tmm_combobox">When Category Save Path changed:</label>
                    </td>
                    <td>
                        <select id="category_changed_tmm_combobox">
                            <option value="true">Relocate affected torrents</option>
                            <option value="false" selected>Switch affected torrents to Manual Mode</option>
                        </select>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="formRow">
            <input type="checkbox" id="use_subcategories_checkbox">
            <label for="use_subcategories_checkbox">Use Subcategories</label>
        </div>
        <div class="formRow">
            <input type="checkbox" id="categoryPathsManualModeCheckbox" title="Resolve relative Save Path against appropriate Category path instead of Default one">
            <label for="categoryPathsManualModeCheckbox">Use Category paths in Manual Mode</label>
        </div>
        <table>
            <tbody>
                <tr>
                    <td>
                        <label for="savepath_text">Default Save Path:</label>
                    </td>
                    <td>
                        <input type="text" id="savepath_text" class="pathDirectory" autocorrect="off" autocapitalize="none">
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="checkbox" id="temppath_checkbox" onclick="qBittorrent.Preferences.updateTempDirEnabled();">
                        <label id="tempPathLabel" for="temppath_checkbox">Keep incomplete torrents in:</label>
                    </td>
                    <td>
                        <input type="text" id="temppath_text" class="pathDirectory" autocorrect="off" autocapitalize="none" aria-labelledby="tempPathLabel">
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="checkbox" id="exportdir_checkbox" onclick="qBittorrent.Preferences.updateExportDirEnabled();">
                        <label id="exportDirLabel" for="exportdir_checkbox">Copy .torrent files to:</label>
                    </td>
                    <td>
                        <input type="text" id="exportdir_text" class="pathDirectory" autocorrect="off" autocapitalize="none" aria-labelledby="exportDirLabel">
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="checkbox" id="exportdirfin_checkbox" onclick="qBittorrent.Preferences.updateExportDirFinEnabled();">
                        <label id="exportDirFinLabel" for="exportdirfin_checkbox">Copy .torrent files for finished downloads to:</label>
                    </td>
                    <td>
                        <input type="text" id="exportdirfin_text" class="pathDirectory" autocorrect="off" autocapitalize="none" aria-labelledby="exportDirFinLabel">
                    </td>
                </tr>
            </tbody>
        </table>
    </fieldset>

    <fieldset class="settings">
        <legend>Automatically add torrents from:</legend>
        <table id="watched_folders_tab" style="border: 1px solid black;">
            <thead>
                <tr>
                    <th scope="col">Monitored Folder</th>
                    <th scope="col">Override Save Location</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </fieldset>

    <fieldset class="settings">
        <legend>
            <input type="checkbox" id="excludedFileNamesCheckbox" onclick="qBittorrent.Preferences.updateExcludedFileNamesEnabled();">
            <label id="excludedFileNamesLabel" for="excludedFileNamesCheckbox">Excluded file names</label>
        </legend>
        <textarea id="excludedFileNamesTextarea" rows="6" cols="70" aria-labelledby="excludedFileNamesLabel"></textarea>
    </fieldset>

    <fieldset class="settings">
        <legend>
            <input type="checkbox" id="mail_notification_checkbox" onclick="qBittorrent.Preferences.updateMailNotification();">
            <label for="mail_notification_checkbox">Email notification upon download completion</label>
        </legend>
        <table>
            <tbody>
                <tr>
                    <td>
                        <label for="src_email_txt">From:</label>
                    </td>
                    <td>
                        <input type="text" id="src_email_txt">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="dest_email_txt">To:</label>
                    </td>
                    <td>
                        <input type="text" id="dest_email_txt">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="smtp_server_txt">SMTP server:</label>
                    </td>
                    <td>
                        <input type="text" id="smtp_server_txt">
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="formRow">
            <input type="checkbox" id="mail_ssl_checkbox"><label for="mail_ssl_checkbox">This server requires a secure connection (SSL)</label>
        </div>
        <fieldset class="settings">
            <legend>
                <input type="checkbox" id="mail_auth_checkbox" onclick="qBittorrent.Preferences.updateMailAuthSettings();">
                <label for="mail_auth_checkbox">Authentication</label>
            </legend>
            <table>
                <tbody>
                    <tr>
                        <td>
                            <label for="mail_username_text">Username:</label>
                        </td>
                        <td>
                            <input type="text" id="mail_username_text">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="mail_password_text">Password:</label>
                        </td>
                        <td>
                            <input type="password" id="mail_password_text">
                        </td>
                    </tr>
                </tbody>
            </table>
        </fieldset>
        <div class="formRow">
            <input type="button" id="mail_test_button" value="Send test email" onclick="qBittorrent.Preferences.sendTestEmail();">
        </div>
    </fieldset>

    <fieldset class="settings">
        <legend>
            Run external program
        </legend>
        <div class="formRow">
            <input type="checkbox" id="autorunOnTorrentAddedCheckbox" onclick="qBittorrent.Preferences.updateAutoRunOnTorrentAdded();">
            <label id="autorunOnTorrentAddedLabel" for="autorunOnTorrentAddedCheckbox">Run on torrent added:</label>
            <input type="text" id="autorunOnTorrentAddedProgram" aria-labelledby="autorunOnTorrentAddedLabel" style="width: 400px;">
        </div>
        <div class="formRow">
            <input type="checkbox" id="autorun_checkbox" onclick="qBittorrent.Preferences.updateAutoRun();">
            <label id="autorunLabel" for="autorun_checkbox">Run on torrent finished:</label>
            <input type="text" id="autorunProg_txt" aria-labelledby="autorunLabel" style="width: 400px;">
        </div>
        <div style="font-style: italic;">Supported parameters (case sensitive):
            <ul>
                <li>%N: Torrent name</li>
                <li>%L: Category</li>
                <li>%G: Tags (separated by comma)</li>
                <li>%F: Content path (same as root path for multifile torrent)</li>
                <li>%R: Root path (first torrent subdirectory path)</li>
                <li>%D: Save path</li>
                <li>%C: Number of files</li>
                <li>%Z: Torrent size (bytes)</li>
                <li>%T: Current tracker</li>
                <li>%I: Info hash v1</li>
                <li>%J: Info hash v2</li>
                <li>%K: Torrent ID</li>
            </ul>
            Tip: Encapsulate parameter with quotation marks to avoid text being cut off at whitespace (e.g., "%N")
        </div>
    </fieldset>
</div>

<div id="ConnectionTab" class="PrefTab invisible">
    <div class="formRow">
        <label for="enable_protocol_combobox">Peer connection protocol:</label>
        <select id="enable_protocol_combobox">
            <option value="0" selected>TCP and μTP</option>
            <option value="1">TCP</option>
            <option value="2">μTP</option>
        </select>
    </div>
    <fieldset class="settings">
        <legend>Listening Port</legend>
        <div class="formRow">
            <label for="port_value">Port used for incoming connections:</label>
            <input type="text" id="port_value" style="width: 4em;" title="Set to 0 to let your system pick an unused port">
            <button type="button" style="margin-left: 1em;" onclick="qBittorrent.Preferences.generateRandomPort();">Random</button>
        </div>
        <div class="formRow">
            <input type="checkbox" id="upnp_checkbox">
            <label for="upnp_checkbox">Use UPnP / NAT-PMP port forwarding from my router</label>
        </div>
    </fieldset>

    <fieldset class="settings">
        <legend>Connections Limits</legend>
        <table>
            <tbody>
                <tr>
                    <td>
                        <input type="checkbox" id="max_connec_checkbox" onclick="qBittorrent.Preferences.updateMaxConnecEnabled();">
                        <label id="maxConnectionsLabel" for="max_connec_checkbox">Global maximum number of connections:</label>
                    </td>
                    <td><input type="text" id="max_connec_value" aria-labelledby="maxConnectionsLabel" style="width: 4em;"></td>
                </tr>
                <tr>
                    <td>
                        <input type="checkbox" id="max_connec_per_torrent_checkbox" onclick="qBittorrent.Preferences.updateMaxConnecPerTorrentEnabled();">
                        <label id="maxConnectionsPerTorrentLabel" for="max_connec_per_torrent_checkbox">Maximum number of connections per torrent:</label>
                    </td>
                    <td><input type="text" id="max_connec_per_torrent_value" aria-labelledby="maxConnectionsPerTorrentLabel" style="width: 4em;"></td>
                </tr>
                <tr>
                    <td>
                        <input type="checkbox" id="max_uploads_checkbox" onclick="qBittorrent.Preferences.updateMaxUploadsEnabled();">
                        <label id="maxUploadsLabel" for="max_uploads_checkbox">Global maximum number of upload slots:</label>
                    </td>
                    <td><input type="text" id="max_uploads_value" aria-labelledby="maxUploadsLabel" style="width: 4em;"></td>
                </tr>
                <tr>
                    <td>
                        <input type="checkbox" id="max_uploads_per_torrent_checkbox" onclick="qBittorrent.Preferences.updateMaxUploadsPerTorrentEnabled();">
                        <label id="maxUploadsPerTorrentLabel" for="max_uploads_per_torrent_checkbox">Maximum number of upload slots per torrent:</label>
                    </td>
                    <td><input type="text" id="max_uploads_per_torrent_value" aria-labelledby="maxUploadsPerTorrentLabel" style="width: 4em;"></td>
                </tr>
            </tbody>
        </table>
    </fieldset>

    <fieldset class="settings" id="fieldsetI2p">
        <legend>
            <input type="checkbox" id="i2pEnabledCheckbox" onclick="qBittorrent.Preferences.updateI2PSettingsEnabled();">
            <label for="i2pEnabledCheckbox">I2P (Experimental)</label>
        </legend>
        <table>
            <tbody>
                <tr>
                    <td>
                        <label for="i2pAddress">Host:</label>
                    </td>
                    <td>
                        <input type="text" id="i2pAddress">
                    </td>
                    <td>
                        <label for="i2pPort">Port:</label>
                    </td>
                    <td>
                        <input type="number" id="i2pPort" min="0" max="65535" onchange="qBittorrent.Preferences.numberInputLimiter(this);" style="width: 5em;">
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="formRow">
            <input type="checkbox" id="i2pMixedMode" title="If &quot;mixed mode&quot; is enabled, I2P torrents are allowed to also get peers from other sources than the tracker, and connect to regular IPs, not providing any anonymization. This may be useful if the user is not interested in the anonymization of I2P, but still wants to be able to connect to I2P peers.">
            <label for="i2pMixedMode">Mixed mode</label>
        </div>
    </fieldset>

    <fieldset class="settings">
        <legend>Proxy Server</legend>
        <table>
            <tbody>
                <tr>
                    <td>
                        <label for="peer_proxy_type_select">Type:</label>
                    </td>
                    <td>
                        <select id="peer_proxy_type_select" onchange="qBittorrent.Preferences.updatePeerProxySettings();">
                            <option value="None">(None)</option>
                            <option value="SOCKS4">SOCKS4</option>
                            <option value="SOCKS5">SOCKS5</option>
                            <option value="HTTP">HTTP</option>
                        </select>
                    </td>
                    <td>
                        <label for="peer_proxy_host_text">Host:</label>
                    </td>
                    <td>
                        <input type="text" id="peer_proxy_host_text">
                    </td>
                    <td>
                        <label for="peer_proxy_port_value">Port:</label>
                    </td>
                    <td>
                        <input type="text" id="peer_proxy_port_value" style="width: 4em;">
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="formRow">
            <input type="checkbox" id="proxyHostnameLookupCheckbox" title="If checked, hostname lookups are done via the proxy.">
            <label for="proxyHostnameLookupCheckbox">Perform hostname lookup via proxy</label>
        </div>

        <fieldset class="settings">
            <legend>
                <input type="checkbox" id="peer_proxy_auth_checkbox" onclick="qBittorrent.Preferences.updatePeerProxyAuthSettings();">
                <label for="peer_proxy_auth_checkbox">Authentication</label>
            </legend>
            <table>
                <tbody>
                    <tr>
                        <td>
                            <label for="peer_proxy_username_text">Username:</label>
                        </td>
                        <td>
                            <input type="text" id="peer_proxy_username_text">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="peer_proxy_password_text">Password:</label>
                        </td>
                        <td>
                            <input type="password" id="peer_proxy_password_text">
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="formRow">
                <span>Info: The password is saved unencrypted</span>
            </div>
        </fieldset>

        <fieldset class="settings">
            <legend>
                <input type="checkbox" id="proxy_bittorrent_checkbox" onclick="qBittorrent.Preferences.updatePeerProxySettings();">
                <label for="proxy_bittorrent_checkbox">Use proxy for BitTorrent purposes</label>
            </legend>
            <div class="formRow">
                <input type="checkbox" id="use_peer_proxy_checkbox">
                <label for="use_peer_proxy_checkbox">Use proxy for peer connections</label>
            </div>
        </fieldset>
        <div class="formRow">
            <input type="checkbox" id="proxy_rss_checkbox">
            <label for="proxy_rss_checkbox">Use proxy for RSS purposes</label>
        </div>
        <div class="formRow">
            <input type="checkbox" id="proxy_misc_checkbox">
            <label for="proxy_misc_checkbox">Use proxy for general purposes</label>
        </div>
    </fieldset>

    <fieldset class="settings">
        <legend>
            <label>IP Filtering</label>
        </legend>
        <div class="formRow">
            <input type="checkbox" id="ipfilter_text_checkbox" onclick="qBittorrent.Preferences.updateFilterSettings();">
            <label id="ipfilterTextLabel" for="ipfilter_text_checkbox">Filter path (.dat, .p2p, .p2b):</label>
            <input type="text" id="ipfilter_text" aria-labelledby="ipfilterTextLabel">
        </div>
        <div class="formRow">
            <input type="checkbox" id="ipfilter_trackers_checkbox">
            <label for="ipfilter_trackers_checkbox">Apply to trackers</label>
        </div>
        <div class="formRow">
            <fieldset class="settings">
                <legend id="manuallyBannedIPAddressesLabel">Manually banned IP addresses...</legend>
                <textarea id="banned_IPs_textarea" aria-labelledby="manuallyBannedIPAddressesLabel" rows="5" cols="70"></textarea>
            </fieldset>
        </div>
    </fieldset>
</div>

<div id="SpeedTab" class="PrefTab invisible">
    <fieldset class="settings">
        <legend>Global Rate Limits</legend>
        <table>
            <tbody>
                <tr>
                    <td rowspan="2">
                        <img src="images/slow_off.svg" style="height: 1.5em;" alt="Alternative speed limits">
                    </td>
                    <td><label for="up_limit_value">Upload:</label></td>
                    <td><input type="number" id="up_limit_value" style="width: 4em;" min="0">&nbsp;&nbsp;KiB/s</td>
                </tr>
                <tr>
                    <td><label for="dl_limit_value">Download:</label></td>
                    <td><input type="number" id="dl_limit_value" style="width: 4em;" min="0">&nbsp;&nbsp;KiB/s</td>
                </tr>
            </tbody>
        </table>
        <i>0 means unlimited</i>
    </fieldset>

    <fieldset class="settings">
        <legend>Alternative Rate Limits</legend>
        <table>
            <tbody>
                <tr>
                    <td rowspan="2">
                        <img src="images/slow.svg" style="height: 1.5em;" alt="Alternative speed limits">
                    </td>
                    <td><label for="alt_up_limit_value">Upload:</label></td>
                    <td><input type="number" id="alt_up_limit_value" style="width: 4em;" min="0">&nbsp;&nbsp;KiB/s</td>
                </tr>
                <tr>
                    <td><label for="alt_dl_limit_value">Download:</label></td>
                    <td><input type="number" id="alt_dl_limit_value" style="width: 4em;" min="0">&nbsp;&nbsp;KiB/s</td>
                </tr>
            </tbody>
        </table>
        <i>0 means unlimited</i>

        <fieldset class="settings">
            <legend>
                <input type="checkbox" id="limitSchedulingCheckbox" onclick="qBittorrent.Preferences.updateSchedulingEnabled();">
                <label for="limitSchedulingCheckbox">Schedule the use of alternative rate limits</label>
            </legend>
            <div class="formRow">
                <label id="scheduleFromHourLabel">From:</label>
                <input type="text" id="schedule_from_hour" aria-labelledby="scheduleFromHourLabel" style="width: 1.5em;">:<input type="text" id="schedule_from_min" aria-labelledby="scheduleFromHourLabel" style="width: 1.5em;">
                <label id="scheduleToHourLabel">To:</label>
                <input type="text" id="schedule_to_hour" aria-labelledby="scheduleToHourLabel" style="width: 1.5em;">:<input type="text" id="schedule_to_min" aria-labelledby="scheduleToHourLabel" style="width: 1.5em;">
            </div>
            <div class="formRow">
                <label for="schedule_freq_select">When:</label>
                <select id="schedule_freq_select">
                    <option value="0">Every day</option>
                    <option value="1">Weekdays</option>
                    <option value="2">Weekends</option>
                    <option value="3">Monday</option>
                    <option value="4">Tuesday</option>
                    <option value="5">Wednesday</option>
                    <option value="6">Thursday</option>
                    <option value="7">Friday</option>
                    <option value="8">Saturday</option>
                    <option value="9">Sunday</option>
                </select>
            </div>
        </fieldset>
    </fieldset>

    <fieldset class="settings">
        <legend>Rate Limits Settings</legend>
        <div class="formRow">
            <input type="checkbox" id="limit_utp_rate_checkbox">
            <label for="limit_utp_rate_checkbox">Apply rate limit to µTP protocol</label>
        </div>
        <div class="formRow">
            <input type="checkbox" id="limit_tcp_overhead_checkbox">
            <label for="limit_tcp_overhead_checkbox">Apply rate limit to transport overhead</label>
        </div>
        <div class="formRow">
            <input type="checkbox" id="limit_lan_peers_checkbox">
            <label for="limit_lan_peers_checkbox">Apply rate limit to peers on LAN</label>
        </div>
    </fieldset>
</div>

<div id="BittorrentTab" class="PrefTab invisible">
    <fieldset class="settings">
        <legend>Privacy</legend>
        <div class="formRow">
            <input type="checkbox" id="dht_checkbox">
            <label for="dht_checkbox">Enable DHT (decentralized network) to find more peers</label>
        </div>
        <div class="formRow">
            <input type="checkbox" id="pex_checkbox">
            <label for="pex_checkbox">Enable Peer Exchange (PeX) to find more peers</label>
        </div>
        <div class="formRow">
            <input type="checkbox" id="lsd_checkbox">
            <label for="lsd_checkbox">Enable Local Peer Discovery to find more peers</label>
        </div>
        <div class="formRow">
            <label for="encryption_select">Encryption mode:</label>
            <select id="encryption_select">
                <option value="0">Allow encryption</option>
                <option value="1">Require encryption</option>
                <option value="2">Disable encryption</option>
            </select>
        </div>
        <div class="formRow">
            <input type="checkbox" id="anonymous_mode_checkbox">
            <label for="anonymous_mode_checkbox">Enable anonymous mode (<a target="_blank" href="https://github.com/qbittorrent/qBittorrent/wiki/Anonymous-Mode">More information</a>)</label>
        </div>
    </fieldset>

    <div class="formRow">
        <label for="maxActiveCheckingTorrents">Max active checking torrents:</label>
        <input type="number" id="maxActiveCheckingTorrents" style="width: 4em;" min="-1">
    </div>

    <fieldset class="settings">
        <legend>
            <input type="checkbox" id="queueing_checkbox" onclick="qBittorrent.Preferences.updateQueueingSystem();">
            <label for="queueing_checkbox">Torrent Queueing</label>
        </legend>
        <table>
            <tbody>
                <tr>
                    <td>
                        <label for="max_active_dl_value">Maximum active downloads:</label>
                    </td>
                    <td>
                        <input type="text" id="max_active_dl_value" style="width: 4em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="max_active_up_value">Maximum active uploads:</label>
                    </td>
                    <td>
                        <input type="text" id="max_active_up_value" style="width: 4em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="max_active_to_value">Maximum active torrents:</label>
                    </td>
                    <td>
                        <input type="text" id="max_active_to_value" style="width: 4em;">
                    </td>
                </tr>
            </tbody>
        </table>
        <fieldset class="settings">
            <legend>
                <input type="checkbox" id="dont_count_slow_torrents_checkbox" onclick="qBittorrent.Preferences.updateSlowTorrentsSettings();">
                <label for="dont_count_slow_torrents_checkbox">Do not count slow torrents in these limits</label>
            </legend>
            <table>
                <tbody>
                    <tr>
                        <td>
                            <label for="dl_rate_threshold">Download rate threshold:</label>
                        </td>
                        <td>
                            <input type="text" id="dl_rate_threshold" style="width: 4em;">&nbsp;&nbsp;KiB/s
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="ul_rate_threshold">Upload rate threshold:</label>
                        </td>
                        <td>
                            <input type="text" id="ul_rate_threshold" style="width: 4em;">&nbsp;&nbsp;KiB/s
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="torrent_inactive_timer">Torrent inactivity timer:</label>
                        </td>
                        <td>
                            <input type="text" id="torrent_inactive_timer" style="width: 4em;">&nbsp;&nbsp;seconds
                        </td>
                    </tr>
                </tbody>
            </table>
        </fieldset>
    </fieldset>

    <fieldset class="settings">
        <legend>Seeding Limits</legend>
        <table>
            <tbody>
                <tr>
                    <td>
                        <input type="checkbox" id="max_ratio_checkbox" onclick="qBittorrent.Preferences.updateMaxRatioTimeEnabled();">
                        <label id="maxRatioLabel" for="max_ratio_checkbox">When ratio reaches</label>
                    </td>
                    <td>
                        <input type="text" id="max_ratio_value" style="width: 4em;" aria-labelledby="maxRatioLabel">
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="checkbox" id="max_seeding_time_checkbox" onclick="qBittorrent.Preferences.updateMaxRatioTimeEnabled();">
                        <label id="maxSeedingTimeLabel" for="max_seeding_time_checkbox">When total seeding time reaches</label>
                    </td>
                    <td>
                        <input type="text" id="max_seeding_time_value" style="width: 4em;" aria-labelledby="maxSeedingTimeLabel">minutes
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="checkbox" id="max_inactive_seeding_time_checkbox" onclick="qBittorrent.Preferences.updateMaxRatioTimeEnabled();">
                        <label id="maxInactiveSeedingTimeLabel" for="max_inactive_seeding_time_checkbox">When inactive seeding time reaches</label>
                    </td>
                    <td>
                        <input type="text" id="max_inactive_seeding_time_value" style="width: 4em;" aria-labelledby="maxInactiveSeedingTimeLabel">minutes
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right;"><label for="max_ratio_act">then</label></td>
                    <td>
                        <select id="max_ratio_act">
                            <option value="0">Stop torrent</option>
                            <option value="1">Remove torrent</option>
                            <option value="3">Remove torrent and its files</option>
                            <option value="2">Enable super seeding for torrent</option>
                        </select>
                    </td>
                </tr>
            </tbody>
        </table>
    </fieldset>

    <fieldset class="settings">
        <legend>
            <input type="checkbox" id="add_trackers_checkbox" onclick="qBittorrent.Preferences.updateAddTrackersEnabled();">
            <label id="addTrackersLabel" for="add_trackers_checkbox">Automatically append these trackers to new downloads:</label>
        </legend>
        <textarea id="add_trackers_textarea" rows="5" cols="70" aria-labelledby="addTrackersLabel"></textarea>
    </fieldset>
</div>

<div id="RSSTab" class="PrefTab invisible">
    <fieldset class="settings">
        <legend>RSS Reader</legend>
        <div class="formRow">
            <input type="checkbox" id="enable_fetching_rss_feeds_checkbox">
            <label for="enable_fetching_rss_feeds_checkbox">Enable fetching RSS feeds</label>
        </div>
        <table>
            <tbody>
                <tr>
                    <td>
                        <label for="feed_refresh_interval">Feeds refresh interval:</label>
                    </td>
                    <td>
                        <input type="text" id="feed_refresh_interval" style="width: 4em;">&nbsp;&nbsp; min
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="feedFetchDelay">Same host request delay:</label>
                    </td>
                    <td>
                        <input type="text" id="feedFetchDelay" style="width: 4em;">&nbsp;&nbsp; sec
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="maximum_article_number">Maximum number of articles per feed:</label>
                    </td>
                    <td>
                        <input type="text" id="maximum_article_number" style="width: 4em;">
                    </td>
                </tr>
            </tbody>
        </table>
    </fieldset>

    <fieldset class="settings">
        <legend>RSS Torrent Auto Downloader</legend>
        <div class="formRow">
            <input type="checkbox" id="enable_auto_downloading_rss_torrents_checkbox">
            <label for="enable_auto_downloading_rss_torrents_checkbox">Enable auto downloading of RSS torrents</label>
        </div>
        <button type="button" style="margin: 0 1em; width: calc(100% - 2.2em)" onclick="window.qBittorrent.Rss.openRssDownloader();">Edit auto downloading rules...</button>
    </fieldset>

    <fieldset class="settings">
        <legend>RSS Smart Episode Filter</legend>
        <div class="formRow">
            <input type="checkbox" id="downlock_repack_proper_episodes">

            <label for="downlock_repack_proper_episodes">Download REPACK/PROPER episodes</label>
        </div>
        <label for="rss_filter_textarea">Filters:</label><br>
        <textarea id="rss_filter_textarea" rows="6" cols="70"></textarea>
    </fieldset>
</div>

<div id="WebUITab" class="PrefTab invisible">
    <fieldset class="settings">
        <legend>Web User Interface (Remote control)</legend>
        <table>
            <tbody>
                <tr>
                    <td>
                        <label for="webui_address_value">IP address:</label>
                    </td>
                    <td>
                        <input type="text" id="webui_address_value">
                        <label for="webui_port_value" style="margin-left: 10px;">Port:</label>
                        <input type="text" id="webui_port_value" style="width: 4em;">
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="formRow">
            <input type="checkbox" id="webui_upnp_checkbox">
            <label for="webui_upnp_checkbox">Use UPnP / NAT-PMP to forward the port from my router</label>
        </div>
        <fieldset class="settings">
            <legend>
                <input type="checkbox" id="use_https_checkbox" onclick="qBittorrent.Preferences.updateHttpsSettings();">
                <label for="use_https_checkbox">Use HTTPS instead of HTTP</label>
            </legend>
            <table>
                <tbody>
                    <tr>
                        <td>
                            <label for="ssl_cert_text">Certificate:</label>
                        </td>
                        <td>
                            <input type="text" id="ssl_cert_text" class="pathFile" style="width: 30em;">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="ssl_key_text">Key:</label>
                        </td>
                        <td>
                            <input type="text" id="ssl_key_text" class="pathFile" style="width: 30em;">
                        </td>
                    </tr>
                </tbody>
            </table>
            <div style="padding-left: 10px;"><a target="_blank" href="https://httpd.apache.org/docs/current/ssl/ssl_faq.html#aboutcerts">Information about certificates</a></div>
        </fieldset>

        <fieldset class="settings">
            <legend>Authentication</legend>
            <table>
                <tbody>
                    <tr>
                        <td>
                            <label for="webui_username_text">Username:</label>
                        </td>
                        <td>
                            <input type="text" id="webui_username_text">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="webui_password_text">Password:</label>
                        </td>
                        <td>
                            <input type="password" id="webui_password_text" placeholder="Change current password" autocomplete="new-password">
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="formRow">
                <input type="checkbox" id="bypass_local_auth_checkbox">
                <label for="bypass_local_auth_checkbox">Bypass authentication for clients on localhost</label>
            </div>
            <div class="formRow">
                <input type="checkbox" id="bypass_auth_subnet_whitelist_checkbox" onclick="qBittorrent.Preferences.updateBypasssAuthSettings();">
                <label id="bypassAuthSubnetWhitelistLabel" for="bypass_auth_subnet_whitelist_checkbox">Bypass authentication for clients in whitelisted IP subnets</label>
            </div>
            <div class="formRow" style="padding-left: 30px; padding-top: 5px;">
                <textarea id="bypass_auth_subnet_whitelist_textarea" rows="5" cols="48" placeholder="Example: 172.17.32.0/24, fdff:ffff:c8::/40" aria-labelledby="bypassAuthSubnetWhitelistLabel"></textarea>
            </div>
            <table>
                <tbody>
                    <tr>
                        <td><label for="webUIMaxAuthFailCountInput">Ban client after consecutive failures:</label></td>
                        <td><input type="number" id="webUIMaxAuthFailCountInput" style="width: 4em;" min="0"></td>
                    </tr>
                    <tr>
                        <td style="text-align: right;"><label for="webUIBanDurationInput">ban for:</label></td>
                        <td><input type="number" id="webUIBanDurationInput" style="width: 4em;" min="1">seconds</td>
                    </tr>
                </tbody>
            </table>
            <table>
                <tbody>
                    <tr>
                        <td><label for="webUISessionTimeoutInput">Session timeout:</label></td>
                        <td><input type="number" id="webUISessionTimeoutInput" style="width: 4em;" min="0">&nbsp;&nbsp;seconds</td>
                    </tr>
                </tbody>
            </table>
        </fieldset>

        <fieldset class="settings">
            <legend><input type="checkbox" id="use_alt_webui_checkbox" onclick="qBittorrent.Preferences.updateAlternativeWebUISettings();">
                <label for="use_alt_webui_checkbox">Use alternative WebUI</label>
            </legend>
            <div class="formRow">
                <label for="webui_files_location_textarea">Files location:</label>
                <input type="text" id="webui_files_location_textarea" class="pathDirectory">
            </div>
            <div class="formRow">
                <a href="https://github.com/qbittorrent/qBittorrent/wiki/List-of-known-alternate-WebUIs" target="_blank">List of alternative WebUI</a>
            </div>
        </fieldset>

        <fieldset class="settings">
            <legend>Security</legend>
            <div class="formRow">
                <input type="checkbox" id="clickjacking_protection_checkbox">
                <label for="clickjacking_protection_checkbox">Enable clickjacking protection</label>
            </div>
            <div class="formRow">
                <input type="checkbox" id="csrf_protection_checkbox">
                <label for="csrf_protection_checkbox">Enable Cross-Site Request Forgery (CSRF) protection</label>
            </div>
            <div class="formRow">
                <input type="checkbox" id="secureCookieCheckbox">
                <label for="secureCookieCheckbox">Enable cookie Secure flag (requires HTTPS or localhost connection)</label>
            </div>

            <fieldset class="settings">
                <legend>
                    <input type="checkbox" id="host_header_validation_checkbox" onclick="qBittorrent.Preferences.updateHostHeaderValidationSettings();">
                    <label for="host_header_validation_checkbox">Enable Host header validation</label>
                </legend>
                <table>
                    <tbody>
                        <tr>
                            <td>
                                <label for="webui_domain_textarea">Server domains:</label>
                            </td>
                            <td>
                                <textarea id="webui_domain_textarea" rows="1" cols="60" title="Whitelist for filtering HTTP Host header values.
In order to defend against DNS rebinding attack,
you should put in domain names used by WebUI server.

Use ';' to split multiple entries. Can use wildcard '*'."></textarea>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </fieldset>
        </fieldset>

        <fieldset class="settings">
            <legend>
                <input type="checkbox" id="webUIUseCustomHTTPHeadersCheckbox" onclick="qBittorrent.Preferences.updateWebUICustomHTTPHeadersSettings();">
                <label id="webUIUseCustomHTTPHeadersLabel" for="webUIUseCustomHTTPHeadersCheckbox">Add custom HTTP headers</label>
            </legend>
            <textarea id="webUICustomHTTPHeadersTextarea" placeholder="Header: value pairs, one per line" aria-labelledby="webUIUseCustomHTTPHeadersLabel" style="width: 90%;"></textarea>
        </fieldset>

        <fieldset class="settings">
            <legend>
                <input type="checkbox" id="webUIReverseProxySupportCheckbox" onclick="qBittorrent.Preferences.updateWebUIReverseProxySettings();">
                <label for="webUIReverseProxySupportCheckbox">Enable reverse proxy support</label>
            </legend>
            <div class="formRow">
                <label for="webUIReverseProxiesListTextarea">Trusted proxies list:</label>
                <input type="text" id="webUIReverseProxiesListTextarea" title="Specify reverse proxy IPs (or subnets, e.g. 0.0.0.0/24) in order to use forwarded client address (X-Forwarded-For header). Use ';' to split multiple entries.">
            </div>
            <div class="formRow">
                <a href="https://github.com/qbittorrent/qBittorrent/wiki#reverse-proxy-setup-for-webui-access" target="_blank">Reverse proxy setup examples</a>
            </div>
        </fieldset>

    </fieldset>

    <fieldset class="settings">
        <legend>
            <input type="checkbox" id="use_dyndns_checkbox" onclick="qBittorrent.Preferences.updateDynDnsSettings();">
            <label id="UseDyndnsLabel" for="use_dyndns_checkbox">Update my dynamic domain name</label>
        </legend>
        <select id="dyndns_select" aria-labelledby="UseDyndnsLabel">
            <option value="0">DynDNS</option>
            <option value="1">NO-IP</option>
        </select>
        <input type="button" value="Register" onclick="qBittorrent.Preferences.registerDynDns();">
        <table style="margin-top: 10px;">
            <tbody>
                <tr>
                    <td>
                        <label for="dyndns_domain_text">Domain name:</label>
                    </td>
                    <td>
                        <input type="text" id="dyndns_domain_text">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="dyndns_username_text">Username:</label>
                    </td>
                    <td>
                        <input type="text" id="dyndns_username_text">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="dyndns_password_text">Password:</label>
                    </td>
                    <td>
                        <input type="password" id="dyndns_password_text">
                    </td>
                </tr>
            </tbody>
        </table>
    </fieldset>
</div>

<div id="AdvancedTab" class="PrefTab invisible">
    <fieldset class="settings">
        <legend>qBittorrent Section&nbsp;(<a href="https://github.com/qbittorrent/qBittorrent/wiki/Explanation-of-Options-in-qBittorrent#Advanced" target="_blank">Open documentation</a>)</legend>
        <table>
            <tbody>
                <tr>
                    <td>
                        <label for="resumeDataStorageType">Resume data storage type (requires restart):</label>
                    </td>
                    <td>
                        <select id="resumeDataStorageType" style="width: 15em;">
                            <option value="Legacy">Fastresume files</option>
                            <option value="SQLite">SQLite database (experimental)</option>
                        </select>
                    </td>
                </tr>
                <tr id="rowMemoryWorkingSetLimit">
                    <td>
                        <label for="torrentContentRemoveOption">Torrent content removing mode:</label>
                    </td>
                    <td>
                        <select id="torrentContentRemoveOption" style="width: 15em;">
                            <option value="Delete">Delete files permanently</option>
                            <option value="MoveToTrash">Move files to trash (if possible)</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="memoryWorkingSetLimit">Physical memory (RAM) usage limit:&nbsp;<a href="https://wikipedia.org/wiki/Working_set" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="memoryWorkingSetLimit" style="width: 15em;" title="This option is less effective on Linux">&nbsp;&nbsp;MiB
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="networkInterface">Network interface:</label>
                    </td>
                    <td>
                        <select id="networkInterface" style="width: 15em;">
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="optionalIPAddressToBind">Optional IP address to bind to:</label>
                    </td>
                    <td>
                        <select id="optionalIPAddressToBind" style="width: 15em;">
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="saveResumeDataInterval">Save resume data interval:</label>
                    </td>
                    <td>
                        <input type="text" id="saveResumeDataInterval" style="width: 15em;">&nbsp;&nbsp;min
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="saveStatisticsInterval">Save statistics interval:</label>
                    </td>
                    <td>
                        <input type="text" id="saveStatisticsInterval" style="width: 15em;">&nbsp;&nbsp;min
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="torrentFileSizeLimit">.torrent file size limit:</label>
                    </td>
                    <td>
                        <input type="text" id="torrentFileSizeLimit" style="width: 15em;">&nbsp;&nbsp;MiB
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="confirmTorrentRecheck">Confirm torrent recheck:</label>
                    </td>
                    <td>
                        <input type="checkbox" id="confirmTorrentRecheck">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="recheckTorrentsOnCompletion">Recheck torrents on completion:</label>
                    </td>
                    <td>
                        <input type="checkbox" id="recheckTorrentsOnCompletion">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="appInstanceName">Customize application instance name:</label>
                    </td>
                    <td>
                        <input type="text" id="appInstanceName" style="width: 15em;" title="It appends the text to the window title to help distinguish qBittorent instances">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="refreshInterval">Refresh interval:</label>
                    </td>
                    <td>
                        <input type="text" id="refreshInterval" style="width: 15em;" title="It controls the internal state update interval which in turn will affect UI updates">&nbsp;&nbsp;ms
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="resolvePeerCountries">Resolve peer countries:</label>
                    </td>
                    <td>
                        <input type="checkbox" id="resolvePeerCountries">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="reannounceWhenAddressChanged">Reannounce to all trackers when IP or port changed:</label>
                    </td>
                    <td>
                        <input type="checkbox" id="reannounceWhenAddressChanged">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="enableEmbeddedTracker">Enable embedded tracker:</label>
                    </td>
                    <td>
                        <input type="checkbox" id="enableEmbeddedTracker">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="embeddedTrackerPort">Embedded tracker port:</label>
                    </td>
                    <td>
                        <input type="text" id="embeddedTrackerPort" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="embeddedTrackerPortForwarding">Enable port forwarding for embedded tracker:</label>
                    </td>
                    <td>
                        <input type="checkbox" id="embeddedTrackerPortForwarding">
                    </td>
                </tr>
                <tr id="rowMarkOfTheWeb">
                    <td>
                        <label for="markOfTheWeb">Enable Mark-of-the-Web (MOTW) for downloaded files (require macOS or Windows):</label>
                    </td>
                    <td>
                        <input type="checkbox" id="markOfTheWeb">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="pythonExecutablePath">Python executable path (may require restart):</label>
                    </td>
                    <td>
                        <input type="text" id="pythonExecutablePath" class="pathFile" placeholder="(Auto detect if empty)" style="width: 15em;">
                    </td>
                </tr>
            </tbody>
        </table>
    </fieldset>
    <fieldset class="settings">
        <legend>libtorrent Section&nbsp;(<a href="https://www.libtorrent.org/reference-Settings.html" target="_blank">Open documentation</a>)</legend>
        <table>
            <tbody>
                <tr>
                    <td>
                        <label for="bdecodeDepthLimit">Bdecode depth limit:&nbsp;<a href="https://www.libtorrent.org/reference-Bdecoding.html#bdecode()" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="bdecodeDepthLimit" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="bdecodeTokenLimit">Bdecode token limit:&nbsp;<a href="https://www.libtorrent.org/reference-Bdecoding.html#bdecode()" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="bdecodeTokenLimit" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="asyncIOThreads">Asynchronous I/O threads:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#aio_threads" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="asyncIOThreads" style="width: 15em;">
                    </td>
                </tr>
                <tr id="rowHashingThreads">
                    <td>
                        <label for="hashingThreads">Hashing threads:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#hashing_threads" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="hashingThreads" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="filePoolSize">File pool size:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#file_pool_size" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="filePoolSize" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="outstandMemoryWhenCheckingTorrents">Outstanding memory when checking torrents:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#checking_mem_usage" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="outstandMemoryWhenCheckingTorrents" style="width: 15em;">&nbsp;&nbsp;MiB
                    </td>
                </tr>
                <tr id="rowDiskCache">
                    <td>
                        <label for="diskCache">Disk cache:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#cache_size" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="diskCache" style="width: 15em;">&nbsp;&nbsp;MiB
                    </td>
                </tr>
                <tr id="rowDiskCacheExpiryInterval">
                    <td>
                        <label for="diskCacheExpiryInterval">Disk cache expiry interval:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#cache_expiry" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="diskCacheExpiryInterval" style="width: 15em;">&nbsp;&nbsp;s
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="diskQueueSize">Disk queue size:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#max_queued_disk_bytes" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="diskQueueSize" style="width: 15em;">&nbsp;&nbsp;KiB
                    </td>
                </tr>
                <tr id="rowDiskIOType">
                    <td>
                        <label for="diskIOType">Disk IO type (requires restart):&nbsp;<a href="https://www.libtorrent.org/single-page-ref.html#default-disk-io-constructor" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <select id="diskIOType" style="width: 15em;">
                            <option value="0">Default</option>
                            <option value="1">Memory mapped files</option>
                            <option value="2">POSIX-compliant</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="diskIOReadMode">Disk IO read mode:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#disk_io_read_mode" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <select id="diskIOReadMode" style="width: 15em;">
                            <option value="0">Disable OS cache</option>
                            <option value="1">Enable OS cache</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="diskIOWriteMode">Disk IO write mode:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#disk_io_write_mode" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <select id="diskIOWriteMode" style="width: 15em;">
                            <option value="0">Disable OS cache</option>
                            <option value="1">Enable OS cache</option>
                            <option value="2" id="diskIOWriteModeWriteThrough">Write-through</option>
                        </select>
                    </td>
                </tr>
                <tr id="rowCoalesceReadsAndWrites">
                    <td>
                        <label for="coalesceReadsAndWrites">Coalesce reads &amp; writes:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#coalesce_reads" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="checkbox" id="coalesceReadsAndWrites">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="pieceExtentAffinity">Use piece extent affinity:&nbsp;<a href="https://libtorrent.org/single-page-ref.html#piece_extent_affinity" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="checkbox" id="pieceExtentAffinity">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="sendUploadPieceSuggestions">Send upload piece suggestions:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#suggest_mode" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="checkbox" id="sendUploadPieceSuggestions">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="sendBufferWatermark">Send buffer watermark:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#send_buffer_watermark" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="sendBufferWatermark" style="width: 15em;">&nbsp;&nbsp;KiB
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="sendBufferLowWatermark">Send buffer low watermark:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#send_buffer_low_watermark" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="sendBufferLowWatermark" style="width: 15em;">&nbsp;&nbsp;KiB
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="sendBufferWatermarkFactor">Send buffer watermark factor:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#send_buffer_watermark_factor" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="sendBufferWatermarkFactor" style="width: 15em;">&nbsp;&nbsp;%
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="connectionSpeed">Outgoing connections per second:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#connection_speed" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="connectionSpeed" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="socketSendBufferSize">Socket send buffer size [0: system default]:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#send_socket_buffer_size" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="socketSendBufferSize" style="width: 15em;">&nbsp;&nbsp;KiB
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="socketReceiveBufferSize">Socket receive buffer size [0: system default]:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#recv_socket_buffer_size" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="socketReceiveBufferSize" style="width: 15em;">&nbsp;&nbsp;KiB
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="socketBacklogSize">Socket backlog size:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#listen_queue_size" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="socketBacklogSize" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="outgoingPortsMin">Outgoing ports (Min) [0: disabled]:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#outgoing_port" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="outgoingPortsMin" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="outgoingPortsMax">Outgoing ports (Max) [0: disabled]:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#outgoing_port" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="outgoingPortsMax" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="UPnPLeaseDuration">UPnP lease duration [0: permanent lease]:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#upnp_lease_duration" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="UPnPLeaseDuration" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="peerToS">Type of service (ToS) for connections to peers&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#peer_tos" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="peerToS" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="utpTCPMixedModeAlgorithm">μTP-TCP mixed mode algorithm:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#mixed_mode_algorithm" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <select id="utpTCPMixedModeAlgorithm" style="width: 15em;">
                            <option value="0">Prefer TCP</option>
                            <option value="1">Peer proportional (throttles TCP)</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="IDNSupportCheckbox">Support internationalized domain name (IDN):&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#allow_idna" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="checkbox" id="IDNSupportCheckbox">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="allowMultipleConnectionsFromTheSameIPAddress">Allow multiple connections from the same IP address:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#allow_multiple_connections_per_ip" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="checkbox" id="allowMultipleConnectionsFromTheSameIPAddress">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="validateHTTPSTrackerCertificate">Validate HTTPS tracker certificate:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#validate_https_trackers" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="checkbox" id="validateHTTPSTrackerCertificate">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="mitigateSSRF">Server-side request forgery (SSRF) mitigation:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#ssrf_mitigation" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="checkbox" id="mitigateSSRF">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="blockPeersOnPrivilegedPorts">Disallow connection to peers on privileged ports:&nbsp;<a href="https://libtorrent.org/single-page-ref.html#no_connect_privileged_ports" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="checkbox" id="blockPeersOnPrivilegedPorts">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="uploadSlotsBehavior">Upload slots behavior:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#choking_algorithm" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <select id="uploadSlotsBehavior" style="width: 15em;">
                            <option value="0">Fixed slots</option>
                            <option value="1">Upload rate based</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="uploadChokingAlgorithm">Upload choking algorithm:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#seed_choking_algorithm" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <select id="uploadChokingAlgorithm" style="width: 15em;">
                            <option value="0">Round-robin</option>
                            <option value="1">Fastest upload</option>
                            <option value="2">Anti-leech</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="announceAllTrackers">Always announce to all trackers in a tier:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#announce_to_all_trackers" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="checkbox" id="announceAllTrackers">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="announceAllTiers">Always announce to all tiers:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#announce_to_all_tiers" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="checkbox" id="announceAllTiers">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="announceIP">IP address reported to trackers (requires restart):&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#announce_ip" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="announceIP" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="maxConcurrentHTTPAnnounces">Max concurrent HTTP announces:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#max_concurrent_http_announces" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="maxConcurrentHTTPAnnounces" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="stopTrackerTimeout">Stop tracker timeout [0: disabled]:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#stop_tracker_timeout" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="stopTrackerTimeout" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="peerTurnover">Peer turnover disconnect percentage:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#peer_turnover" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="peerTurnover" style="width: 15em;">&nbsp;&nbsp;%
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="peerTurnoverCutoff">Peer turnover threshold percentage:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#peer_turnover" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="peerTurnoverCutoff" style="width: 15em;">&nbsp;&nbsp;%
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="peerTurnoverInterval">Peer turnover disconnect interval:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#peer_turnover" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="peerTurnoverInterval" style="width: 15em;">&nbsp;&nbsp;s
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="requestQueueSize">Maximum outstanding requests to a single peer:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#max_out_request_queue" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="requestQueueSize" style="width: 15em;">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="dhtBootstrapNodes">DHT bootstrap nodes:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#dht_bootstrap_nodes" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input type="text" id="dhtBootstrapNodes" placeholder="Resets to default if empty" style="width: 15em;">
                    </td>
                </tr>
                <tr id="rowI2pInboundQuantity">
                    <td>
                        <label for="i2pInboundQuantity">I2P inbound quantity:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#i2p_inbound_quantity" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input id="i2pInboundQuantity" type="number" min="1" max="16" onchange="qBittorrent.Preferences.numberInputLimiter(this);" style="width: 15em;">
                    </td>
                </tr>
                <tr id="rowI2pOutboundQuantity">
                    <td>
                        <label for="i2pOutboundQuantity">I2P outbound quantity:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#i2p_outbound_quantity" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input id="i2pOutboundQuantity" type="number" min="1" max="16" onchange="qBittorrent.Preferences.numberInputLimiter(this);" style="width: 15em;">
                    </td>
                </tr>
                <tr id="rowI2pInboundLength">
                    <td>
                        <label for="i2pInboundLength">I2P inbound length:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#i2p_inbound_length" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input id="i2pInboundLength" type="number" min="0" max="7" onchange="qBittorrent.Preferences.numberInputLimiter(this);" style="width: 15em;">
                    </td>
                </tr>
                <tr id="rowI2pOutboundLength">
                    <td>
                        <label for="i2pOutboundLength">I2P outbound length:&nbsp;<a href="https://www.libtorrent.org/reference-Settings.html#i2p_outbound_length" target="_blank">(?)</a></label>
                    </td>
                    <td>
                        <input id="i2pOutboundLength" type="number" min="0" max="7" onchange="qBittorrent.Preferences.numberInputLimiter(this);" style="width: 15em;">
                    </td>
                </tr>
            </tbody>
        </table>
    </fieldset>
</div>

<div style="text-align: center; margin-top: 1em;"><input type="button" value="Save" onclick="qBittorrent.Preferences.applyPreferences();"></div>

<script>
    "use strict";

    window.qBittorrent ??= {};
    window.qBittorrent.Preferences ??= (() => {
        const exports = () => {
            return {
                setup: setup,
                numberInputLimiter: numberInputLimiter,
                updateFileLogEnabled: updateFileLogEnabled,
                updateFileLogBackupEnabled: updateFileLogBackupEnabled,
                updateFileLogDeleteEnabled: updateFileLogDeleteEnabled,
                updateTempDirEnabled: updateTempDirEnabled,
                updateExportDirEnabled: updateExportDirEnabled,
                updateExportDirFinEnabled: updateExportDirFinEnabled,
                addWatchFolder: addWatchFolder,
                updateExcludedFileNamesEnabled: updateExcludedFileNamesEnabled,
                changeWatchFolderSelect: changeWatchFolderSelect,
                updateMailNotification: updateMailNotification,
                updateMailAuthSettings: updateMailAuthSettings,
                sendTestEmail: sendTestEmail,
                updateAutoRun: updateAutoRun,
                updateAutoRunOnTorrentAdded: updateAutoRunOnTorrentAdded,
                generateRandomPort: generateRandomPort,
                updateMaxConnecEnabled: updateMaxConnecEnabled,
                updateMaxConnecPerTorrentEnabled: updateMaxConnecPerTorrentEnabled,
                updateMaxUploadsEnabled: updateMaxUploadsEnabled,
                updateMaxUploadsPerTorrentEnabled: updateMaxUploadsPerTorrentEnabled,
                updateI2PSettingsEnabled: updateI2PSettingsEnabled,
                updatePeerProxySettings: updatePeerProxySettings,
                updatePeerProxyAuthSettings: updatePeerProxyAuthSettings,
                updateFilterSettings: updateFilterSettings,
                updateSchedulingEnabled: updateSchedulingEnabled,
                updateQueueingSystem: updateQueueingSystem,
                updateSlowTorrentsSettings: updateSlowTorrentsSettings,
                updateMaxRatioTimeEnabled: updateMaxRatioTimeEnabled,
                updateAddTrackersEnabled: updateAddTrackersEnabled,
                updateHttpsSettings: updateHttpsSettings,
                updateBypasssAuthSettings: updateBypasssAuthSettings,
                updateAlternativeWebUISettings: updateAlternativeWebUISettings,
                updateHostHeaderValidationSettings: updateHostHeaderValidationSettings,
                updateWebUICustomHTTPHeadersSettings: updateWebUICustomHTTPHeadersSettings,
                updateWebUIReverseProxySettings: updateWebUIReverseProxySettings,
                updateDynDnsSettings: updateDynDnsSettings,
                updateWebuiLocaleSelect: updateWebuiLocaleSelect,
                registerDynDns: registerDynDns,
                applyPreferences: applyPreferences
            };
        };

        // Behavior tab
        const numberInputLimiter = (input) => {
            const min = input.getAttribute("min");
            const max = input.getAttribute("max");

            if (min && (input.value.toInt() < min.toInt()))
                input.value = min;

            if (max && (input.value.toInt() > max.toInt()))
                input.value = max;
        };

        const updateFileLogEnabled = function() {
            const isFileLogEnabled = $("filelog_checkbox").checked;
            $("filelog_save_path_input").disabled = !isFileLogEnabled;
            $("filelog_backup_checkbox").disabled = !isFileLogEnabled;
            $("filelog_delete_old_checkbox").disabled = !isFileLogEnabled;

            updateFileLogBackupEnabled();
            updateFileLogDeleteEnabled();
        };

        const updateFileLogBackupEnabled = function() {
            const pros = $("filelog_backup_checkbox").getProperties("disabled", "checked");
            $("filelog_max_size_input").disabled = pros.disabled || !pros.checked;
        };

        const updateFileLogDeleteEnabled = function() {
            const pros = $("filelog_delete_old_checkbox").getProperties("disabled", "checked");
            $("filelog_age_input").disabled = pros.disabled || !pros.checked;
            $("filelog_age_type_select").disabled = pros.disabled || !pros.checked;
        };

        // Downloads tab
        let watchedFoldersTable;

        const updateTempDirEnabled = function() {
            const isTempDirEnabled = $("temppath_checkbox").checked;
            $("temppath_text").disabled = !isTempDirEnabled;
        };

        const changeWatchFolderSelect = (item) => {
            if (item.value === "other") {
                item.nextElementSibling.hidden = false;
                item.nextElementSibling.value = "Type folder here";
                item.nextElementSibling.select();
            }
            else {
                item.nextElementSibling.hidden = true;
                const text = item.options[item.selectedIndex].textContent;
                item.nextElementSibling.value = text;
            }
        };

        const addWatchFolder = (folder = "", sel = "default_folder", other = "") => {
            const pos = $("watched_folders_tab").getChildren("tbody")[0].getChildren("tr").length;
            const myinput = "<input id='text_watch_" + pos + "' type='text' value='" + folder + "'>";
            const disableInput = (sel !== "other");
            const mycb = "<div class='select-watched-folder-editable'>"
                + "<select id ='cb_watch_" + pos + "' onchange='qBittorrent.Preferences.changeWatchFolderSelect(this)'>"
                + "<option value='watch_folder'>Monitored folder</option>"
                + "<option value='default_folder'>Default save location</option>"
                + "<option value='other'>Other...</option>"
                + "</select>"
                + "<input id='cb_watch_txt_" + pos + "' type='text' " + (disableInput ? "hidden " : "") + "/>"
                + "<img src='images/list-add.svg' id='addFolderImg_" + pos + "' alt='Add' style='padding-left:170px;width:16px;cursor:pointer;' onclick='qBittorrent.Preferences.addWatchFolder();'>"
                + "</div>";

            watchedFoldersTable.push([myinput, mycb]);
            $("cb_watch_" + pos).value = sel;
            if (disableInput) {
                const elt = $("cb_watch_" + pos);
                other = elt.options[elt.selectedIndex].textContent;
            }
            $("cb_watch_txt_" + pos).value = other;

            // hide previous img
            if (pos > 0)
                $("addFolderImg_" + (pos - 1)).style.display = "none";
        };

        const getWatchedFolders = () => {
            const nb_folders = $("watched_folders_tab").getChildren("tbody")[0].getChildren("tr").length;
            const folders = new Hash();
            for (let i = 0; i < nb_folders; ++i) {
                const fpath = $("text_watch_" + i).value.trim();
                if (fpath.length > 0) {
                    const sel = $("cb_watch_" + i).value.trim();

                    let other;
                    if (sel === "other")
                        other = $("cb_watch_txt_" + i).value.trim();
                    else
                        other = (sel === "watch_folder") ? 0 : 1;

                    folders.set(fpath, other);
                }
            }
            return folders;
        };

        const updateExcludedFileNamesEnabled = function() {
            const isAExcludedFileNamesEnabled = $("excludedFileNamesCheckbox").checked;
            $("excludedFileNamesTextarea").disabled = !isAExcludedFileNamesEnabled;
        };

        const updateExportDirEnabled = function() {
            const isExportDirEnabled = $("exportdir_checkbox").checked;
            $("exportdir_text").disabled = !isExportDirEnabled;
        };

        const updateExportDirFinEnabled = function() {
            const isExportDirFinEnabled = $("exportdirfin_checkbox").checked;
            $("exportdirfin_text").disabled = !isExportDirFinEnabled;
        };

        const updateMailNotification = function() {
            const isMailNotificationEnabled = $("mail_notification_checkbox").checked;
            $("src_email_txt").disabled = !isMailNotificationEnabled;
            $("dest_email_txt").disabled = !isMailNotificationEnabled;
            $("smtp_server_txt").disabled = !isMailNotificationEnabled;
            $("mail_ssl_checkbox").disabled = !isMailNotificationEnabled;
            $("mail_auth_checkbox").disabled = !isMailNotificationEnabled;
            $("mail_test_button").disabled = !isMailNotificationEnabled;

            if (!isMailNotificationEnabled) {
                $("mail_auth_checkbox").checked = !isMailNotificationEnabled;
                updateMailAuthSettings();
            }
        };

        const updateMailAuthSettings = function() {
            const isMailAuthEnabled = $("mail_auth_checkbox").checked;
            $("mail_username_text").disabled = !isMailAuthEnabled;
            $("mail_password_text").disabled = !isMailAuthEnabled;
        };

        const sendTestEmail = function() {
            new Request({
                url: "api/v2/app/sendTestEmail",
                method: "post",
                onFailure: function() {
                    alert("Could not contact qBittorrent");
                },
                onSuccess: function() {
                    alert("Attempted to send email. Check your inbox to confirm success");
                }
            }).send();
        };

        const updateAutoRunOnTorrentAdded = function() {
            const isAutoRunOnTorrentAddedEnabled = $("autorunOnTorrentAddedCheckbox").checked;
            $("autorunOnTorrentAddedProgram").disabled = !isAutoRunOnTorrentAddedEnabled;
        };

        const updateAutoRun = function() {
            const isAutoRunEnabled = $("autorun_checkbox").checked;
            $("autorunProg_txt").disabled = !isAutoRunEnabled;
        };

        // Connection tab

        const updateMaxConnecEnabled = function() {
            const isMaxConnecEnabled = $("max_connec_checkbox").checked;
            $("max_connec_value").disabled = !isMaxConnecEnabled;
        };

        const updateMaxConnecPerTorrentEnabled = function() {
            const isMaxConnecPerTorrentEnabled = $("max_connec_per_torrent_checkbox").checked;
            $("max_connec_per_torrent_value").disabled = !isMaxConnecPerTorrentEnabled;
        };

        const updateMaxUploadsEnabled = function() {
            const isMaxUploadsEnabled = $("max_uploads_checkbox").checked;
            $("max_uploads_value").disabled = !isMaxUploadsEnabled;
        };

        const updateMaxUploadsPerTorrentEnabled = function() {
            const isMaxUploadsPerTorrentEnabled = $("max_uploads_per_torrent_checkbox").checked;
            $("max_uploads_per_torrent_value").disabled = !isMaxUploadsPerTorrentEnabled;
        };

        const updateI2PSettingsEnabled = function() {
            const isI2PEnabled = $("i2pEnabledCheckbox").checked;
            $("i2pAddress").disabled = !isI2PEnabled;
            $("i2pPort").disabled = !isI2PEnabled;
            $("i2pMixedMode").disabled = !isI2PEnabled;
        };

        const updatePeerProxySettings = function() {
            const proxyType = $("peer_proxy_type_select").value;
            const isProxyDisabled = (proxyType === "None");
            const isProxySocks4 = (proxyType === "SOCKS4");

            $("peer_proxy_host_text").disabled = isProxyDisabled;
            $("peer_proxy_port_value").disabled = isProxyDisabled;

            $("peer_proxy_auth_checkbox").disabled = (isProxyDisabled || isProxySocks4);
            $("proxy_bittorrent_checkbox").disabled = isProxyDisabled;
            $("use_peer_proxy_checkbox").disabled = (isProxyDisabled || !$("proxy_bittorrent_checkbox").checked);
            $("proxyHostnameLookupCheckbox").disabled = (isProxyDisabled || isProxySocks4);
            $("proxy_rss_checkbox").disabled = (isProxyDisabled || isProxySocks4);
            $("proxy_misc_checkbox").disabled = (isProxyDisabled || isProxySocks4);

            updatePeerProxyAuthSettings();
        };

        const updatePeerProxyAuthSettings = function() {
            const proxyType = $("peer_proxy_type_select").value;
            const isProxyDisabled = (proxyType === "None");
            const isPeerProxyAuthEnabled = (!$("peer_proxy_auth_checkbox").disabled && $("peer_proxy_auth_checkbox").checked);
            $("peer_proxy_username_text").disabled = (isProxyDisabled || !isPeerProxyAuthEnabled);
            $("peer_proxy_password_text").disabled = (isProxyDisabled || !isPeerProxyAuthEnabled);
        };

        const updateFilterSettings = function() {
            const isIPFilterEnabled = $("ipfilter_text_checkbox").checked;
            $("ipfilter_text").disabled = !isIPFilterEnabled;
        };

        // Speed tab
        const updateSchedulingEnabled = function() {
            const isLimitSchedulingEnabled = $("limitSchedulingCheckbox").checked;
            $("schedule_from_hour").disabled = !isLimitSchedulingEnabled;
            $("schedule_from_min").disabled = !isLimitSchedulingEnabled;
            $("schedule_to_hour").disabled = !isLimitSchedulingEnabled;
            $("schedule_to_min").disabled = !isLimitSchedulingEnabled;
            $("schedule_freq_select").disabled = !isLimitSchedulingEnabled;
        };

        // Bittorrent tab
        const updateQueueingSystem = function() {
            const isQueueingEnabled = $("queueing_checkbox").checked;
            $("max_active_dl_value").disabled = !isQueueingEnabled;
            $("max_active_up_value").disabled = !isQueueingEnabled;
            $("max_active_to_value").disabled = !isQueueingEnabled;
            $("dont_count_slow_torrents_checkbox").disabled = !isQueueingEnabled;
            updateSlowTorrentsSettings();
        };

        const updateSlowTorrentsSettings = function() {
            const isDontCountSlowTorrentsEnabled = (!$("dont_count_slow_torrents_checkbox").disabled) && $("dont_count_slow_torrents_checkbox").checked;
            $("dl_rate_threshold").disabled = !isDontCountSlowTorrentsEnabled;
            $("ul_rate_threshold").disabled = !isDontCountSlowTorrentsEnabled;
            $("torrent_inactive_timer").disabled = !isDontCountSlowTorrentsEnabled;
        };

        const updateMaxRatioTimeEnabled = function() {
            const isMaxRatioEnabled = $("max_ratio_checkbox").checked;
            $("max_ratio_value").disabled = !isMaxRatioEnabled;

            const isMaxSeedingTimeEnabled = $("max_seeding_time_checkbox").checked;
            $("max_seeding_time_value").disabled = !isMaxSeedingTimeEnabled;

            const isMaxInactiveSeedingTimeEnabled = $("max_inactive_seeding_time_checkbox").checked;
            $("max_inactive_seeding_time_value").disabled = !isMaxInactiveSeedingTimeEnabled;

            $("max_ratio_act").disabled = !(isMaxRatioEnabled || isMaxSeedingTimeEnabled || isMaxInactiveSeedingTimeEnabled);
        };

        const updateAddTrackersEnabled = function() {
            const isAddTrackersEnabled = $("add_trackers_checkbox").checked;
            $("add_trackers_textarea").disabled = !isAddTrackersEnabled;
        };

        // WebUI tab
        const updateHttpsSettings = function() {
            const isUseHttpsEnabled = $("use_https_checkbox").checked;
            $("ssl_cert_text").disabled = !isUseHttpsEnabled;
            $("ssl_key_text").disabled = !isUseHttpsEnabled;
        };

        const updateBypasssAuthSettings = function() {
            const isBypassAuthSubnetWhitelistEnabled = $("bypass_auth_subnet_whitelist_checkbox").checked;
            $("bypass_auth_subnet_whitelist_textarea").disabled = !isBypassAuthSubnetWhitelistEnabled;
        };

        const updateAlternativeWebUISettings = function() {
            const isUseAlternativeWebUIEnabled = $("use_alt_webui_checkbox").checked;
            $("webui_files_location_textarea").disabled = !isUseAlternativeWebUIEnabled;
        };

        const updateHostHeaderValidationSettings = function() {
            const isHostHeaderValidationEnabled = $("host_header_validation_checkbox").checked;
            $("webui_domain_textarea").disabled = !isHostHeaderValidationEnabled;
        };

        const updateWebUICustomHTTPHeadersSettings = function() {
            const isEnabled = $("webUIUseCustomHTTPHeadersCheckbox").checked;
            $("webUICustomHTTPHeadersTextarea").disabled = !isEnabled;
        };

        const updateWebUIReverseProxySettings = function() {
            const isEnabled = $("webUIReverseProxySupportCheckbox").checked;
            $("webUIReverseProxiesListTextarea").disabled = !isEnabled;
        };

        const updateDynDnsSettings = function() {
            const isDynDnsEnabled = $("use_dyndns_checkbox").checked;
            $("dyndns_select").disabled = !isDynDnsEnabled;
            $("dyndns_domain_text").disabled = !isDynDnsEnabled;
            $("dyndns_username_text").disabled = !isDynDnsEnabled;
            $("dyndns_password_text").disabled = !isDynDnsEnabled;
        };

        const registerDynDns = function() {
            if ($("dyndns_select").value.toInt() === 1)
                window.open("http://www.no-ip.com/services/managed_dns/free_dynamic_dns.html", "NO-IP Registration");
            else
                window.open("https://www.dyndns.com/account/services/hosts/add.html", "DynDNS Registration");
        };

        const generateRandomPort = function() {
            const min = 1024;
            const max = 65535;
            const port = Math.floor(Math.random() * (max - min + 1) + min);
            $("port_value").value = port;
        };

        const time_padding = function(val) {
            let ret = val.toString();
            if (ret.length === 1)
                ret = "0" + ret;
            return ret;
        };

        // Advanced Tab
        const updateNetworkInterfaces = function(default_iface, default_iface_name) {
            const url = "api/v2/app/networkInterfaceList";
            $("networkInterface").getChildren().each(c => c.destroy());
            new Request.JSON({
                url: url,
                method: "get",
                noCache: true,
                onFailure: function() {
                    alert("Could not contact qBittorrent");
                },
                onSuccess: function(ifaces) {
                    if (!Array.isArray(ifaces))
                        return;

                    // add the current network interface to the options if needed
                    if (default_iface && !ifaces.some((item) => item.value === default_iface))
                        ifaces.push({ name: default_iface_name || default_iface, value: default_iface });

                    $("networkInterface").options.add(new Option("Any interface", ""));
                    ifaces.forEach((item, index) => {
                        $("networkInterface").options.add(new Option(item.name, item.value));
                    });
                    $("networkInterface").value = default_iface;
                }
            }).send();
        };

        const updateInterfaceAddresses = function(iface, default_addr) {
            const url = "api/v2/app/networkInterfaceAddressList";
            $("optionalIPAddressToBind").getChildren().each(c => c.destroy());
            new Request.JSON({
                url: url,
                method: "get",
                noCache: true,
                data: {
                    "iface": iface
                },
                onFailure: function() {
                    alert("Could not contact qBittorrent");
                },
                onSuccess: function(addresses) {
                    if (!addresses)
                        return;

                    $("optionalIPAddressToBind").options.add(new Option("All addresses", ""));
                    $("optionalIPAddressToBind").options.add(new Option("All IPv4 addresses", "0.0.0.0"));
                    $("optionalIPAddressToBind").options.add(new Option("All IPv6 addresses", "::"));
                    addresses.forEach((item, index) => {
                        $("optionalIPAddressToBind").options.add(new Option(item, item));
                    });
                    $("optionalIPAddressToBind").value = default_addr;
                }
            }).send();
        };

        const updateWebuiLocaleSelect = (selected) => {
            const languages = [];
            for (let i = 0; i < $("locale_select").options.length; i++)
                languages.push($("locale_select").options[i].value);

            if (!languages.includes(selected)) {
                const lang = selected.slice(0, selected.indexOf("_"));
                selected = languages.includes(lang) ? lang : "en";
            }
            $("locale_select").value = selected;
        };

        const loadPreferences = function() {
            window.parent.qBittorrent.Cache.preferences.init({
                onSuccess: (pref) => {
                    // Behavior tab
                    document.getElementById("displayFullURLTrackerColumn").checked = (LocalPreferences.get("full_url_tracker_column", "false") === "true");
                    document.getElementById("hideZeroFiltersCheckbox").checked = (LocalPreferences.get("hide_zero_status_filters", "false") === "true");
                    $("dblclickDownloadSelect").value = LocalPreferences.get("dblclick_download", "1");
                    $("dblclickCompleteSelect").value = LocalPreferences.get("dblclick_complete", "1");
                    document.getElementById("confirmTorrentDeletion").checked = pref.confirm_torrent_deletion;
                    document.getElementById("useAltRowColorsInput").checked = (LocalPreferences.get("use_alt_row_colors", "true") === "true");
                    $("filelog_checkbox").checked = pref.file_log_enabled;
                    $("filelog_save_path_input").value = pref.file_log_path;
                    $("filelog_backup_checkbox").checked = pref.file_log_backup_enabled;
                    $("filelog_max_size_input").value = pref.file_log_max_size;
                    $("filelog_delete_old_checkbox").checked = pref.file_log_delete_old;
                    $("filelog_age_input").value = pref.file_log_age;
                    $("filelog_age_type_select").value = pref.file_log_age_type;
                    updateFileLogEnabled();

                    // Downloads tab
                    // When adding a torrent
                    let index = 0;
                    switch (pref.torrent_content_layout) {
                        case "Original":
                            index = 0;
                            break;
                        case "Subfolder":
                            index = 1;
                            break;
                        case "NoSubfolder":
                            index = 2;
                            break;
                    }
                    $("contentlayout_select").getChildren("option")[index].selected = true;
                    $("addToTopOfQueueCheckbox").checked = pref.add_to_top_of_queue;
                    $("dontstartdownloads_checkbox").checked = pref.add_stopped_enabled;
                    switch (pref.torrent_stop_condition) {
                        case "None":
                            index = 0;
                            break;
                        case "MetadataReceived":
                            index = 1;
                            break;
                        case "FilesChecked":
                            index = 2;
                            break;
                    }
                    $("stopConditionSelect").getChildren("option")[index].selected = true;
                    document.getElementById("mergeTrackersInput").checked = pref.merge_trackers;
                    $("deletetorrentfileafter_checkbox").checked = pref.auto_delete_mode;

                    $("preallocateall_checkbox").checked = pref.preallocate_all;
                    $("appendext_checkbox").checked = pref.incomplete_files_ext;
                    $("unwantedfolder_checkbox").checked = pref.use_unwanted_folder;

                    // Saving Management
                    $("default_tmm_combobox").value = pref.auto_tmm_enabled;
                    $("torrent_changed_tmm_combobox").value = pref.torrent_changed_tmm_enabled;
                    $("save_path_changed_tmm_combobox").value = pref.save_path_changed_tmm_enabled;
                    $("category_changed_tmm_combobox").value = pref.category_changed_tmm_enabled;
                    $("use_subcategories_checkbox").checked = pref.use_subcategories;
                    document.getElementById("categoryPathsManualModeCheckbox").checked = pref.use_category_paths_in_manual_mode;
                    $("savepath_text").value = pref.save_path;
                    $("temppath_checkbox").checked = pref.temp_path_enabled;
                    $("temppath_text").value = pref.temp_path;
                    updateTempDirEnabled();
                    if (pref.export_dir !== "") {
                        $("exportdir_checkbox").checked = true;
                        $("exportdir_text").value = pref.export_dir;
                    }
                    else {
                        $("exportdir_checkbox").checked = false;
                        $("exportdir_text").value = "";
                    }
                    updateExportDirEnabled();
                    if (pref.export_dir_fin !== "") {
                        $("exportdirfin_checkbox").checked = true;
                        $("exportdirfin_text").value = pref.export_dir_fin;
                    }
                    else {
                        $("exportdirfin_checkbox").checked = false;
                        $("exportdirfin_text").value = "";
                    }
                    updateExportDirFinEnabled();

                    // Automatically add torrents from
                    for (const folder in pref.scan_dirs) {
                        if (!Object.hasOwn(pref.scan_dirs, folder))
                            continue;

                        const folderType = pref.scan_dirs[folder];
                        let sel = "";
                        let other = "";
                        if (typeof folderType === "number") {
                            sel = (folderType === 0) ? "watch_folder" : "default_folder";
                        }
                        else {
                            sel = "other";
                            other = folderType;
                        }
                        addWatchFolder(folder, sel, other);
                    }
                    addWatchFolder();

                    // Excluded file names
                    $("excludedFileNamesCheckbox").checked = pref.excluded_file_names_enabled;
                    $("excludedFileNamesTextarea").value = pref.excluded_file_names;

                    // Email notification upon download completion
                    $("mail_notification_checkbox").checked = pref.mail_notification_enabled;
                    $("src_email_txt").value = pref.mail_notification_sender;
                    $("dest_email_txt").value = pref.mail_notification_email;
                    $("smtp_server_txt").value = pref.mail_notification_smtp;
                    $("mail_ssl_checkbox").checked = pref.mail_notification_ssl_enabled;
                    $("mail_auth_checkbox").checked = pref.mail_notification_auth_enabled;
                    $("mail_username_text").value = pref.mail_notification_username;
                    $("mail_password_text").value = pref.mail_notification_password;
                    updateMailNotification();
                    updateMailAuthSettings();

                    // Run an external program on torrent added
                    $("autorunOnTorrentAddedCheckbox").checked = pref.autorun_on_torrent_added_enabled;
                    $("autorunOnTorrentAddedProgram").value = pref.autorun_on_torrent_added_program;
                    updateAutoRunOnTorrentAdded();
                    // Run an external program on torrent finished
                    $("autorun_checkbox").checked = pref.autorun_enabled;
                    $("autorunProg_txt").value = pref.autorun_program;
                    updateAutoRun();

                    // Connection tab
                    // Listening Port
                    $("port_value").value = pref.listen_port.toInt();
                    $("upnp_checkbox").checked = pref.upnp;

                    // Connections Limits
                    const max_connec = pref.max_connec.toInt();
                    if (max_connec <= 0) {
                        $("max_connec_checkbox").checked = false;
                        $("max_connec_value").value = 500;
                    }
                    else {
                        $("max_connec_checkbox").checked = true;
                        $("max_connec_value").value = max_connec;
                    }
                    updateMaxConnecEnabled();
                    const max_connec_per_torrent = pref.max_connec_per_torrent.toInt();
                    if (max_connec_per_torrent <= 0) {
                        $("max_connec_per_torrent_checkbox").checked = false;
                        $("max_connec_per_torrent_value").value = 100;
                    }
                    else {
                        $("max_connec_per_torrent_checkbox").checked = true;
                        $("max_connec_per_torrent_value").value = max_connec_per_torrent;
                    }
                    updateMaxConnecPerTorrentEnabled();
                    const max_uploads = pref.max_uploads.toInt();
                    if (max_uploads <= 0) {
                        $("max_uploads_checkbox").checked = false;
                        $("max_uploads_value").value = 8;
                    }
                    else {
                        $("max_uploads_checkbox").checked = true;
                        $("max_uploads_value").value = max_uploads;
                    }
                    updateMaxUploadsEnabled();
                    const max_uploads_per_torrent = pref.max_uploads_per_torrent.toInt();
                    if (max_uploads_per_torrent <= 0) {
                        $("max_uploads_per_torrent_checkbox").checked = false;
                        $("max_uploads_per_torrent_value").value = 4;
                    }
                    else {
                        $("max_uploads_per_torrent_checkbox").checked = true;
                        $("max_uploads_per_torrent_value").value = max_uploads_per_torrent;
                    }
                    updateMaxUploadsPerTorrentEnabled();

                    // I2P
                    $("i2pEnabledCheckbox").checked = pref.i2p_enabled;
                    $("i2pAddress").value = pref.i2p_address;
                    $("i2pPort").value = pref.i2p_port;
                    $("i2pMixedMode").checked = pref.i2p_mixed_mode;
                    updateI2PSettingsEnabled();

                    // Proxy Server
                    $("peer_proxy_type_select").value = pref.proxy_type;
                    $("peer_proxy_host_text").value = pref.proxy_ip;
                    $("peer_proxy_port_value").value = pref.proxy_port;
                    $("peer_proxy_auth_checkbox").checked = pref.proxy_auth_enabled;
                    $("peer_proxy_username_text").value = pref.proxy_username;
                    $("peer_proxy_password_text").value = pref.proxy_password;
                    $("proxyHostnameLookupCheckbox").checked = pref.proxy_hostname_lookup;
                    $("proxy_bittorrent_checkbox").checked = pref.proxy_bittorrent;
                    $("use_peer_proxy_checkbox").checked = pref.proxy_peer_connections;
                    $("proxy_rss_checkbox").checked = pref.proxy_rss;
                    $("proxy_misc_checkbox").checked = pref.proxy_misc;
                    updatePeerProxySettings();

                    // IP Filtering
                    $("ipfilter_text_checkbox").checked = pref.ip_filter_enabled;
                    $("ipfilter_text").value = pref.ip_filter_path;
                    $("ipfilter_trackers_checkbox").checked = pref.ip_filter_trackers;
                    $("banned_IPs_textarea").value = pref.banned_IPs;
                    updateFilterSettings();

                    // Speed tab
                    // Global Rate Limits
                    $("up_limit_value").value = (pref.up_limit.toInt() / 1024);
                    $("dl_limit_value").value = (pref.dl_limit.toInt() / 1024);
                    // Alternative Global Rate Limits
                    $("alt_up_limit_value").value = (pref.alt_up_limit.toInt() / 1024);
                    $("alt_dl_limit_value").value = (pref.alt_dl_limit.toInt() / 1024);

                    $("enable_protocol_combobox").value = pref.bittorrent_protocol;
                    $("limit_utp_rate_checkbox").checked = pref.limit_utp_rate;
                    $("limit_tcp_overhead_checkbox").checked = pref.limit_tcp_overhead;
                    $("limit_lan_peers_checkbox").checked = pref.limit_lan_peers;

                    // Scheduling
                    $("limitSchedulingCheckbox").checked = pref.scheduler_enabled;
                    $("schedule_from_hour").value = time_padding(pref.schedule_from_hour);
                    $("schedule_from_min").value = time_padding(pref.schedule_from_min);
                    $("schedule_to_hour").value = time_padding(pref.schedule_to_hour);
                    $("schedule_to_min").value = time_padding(pref.schedule_to_min);
                    $("schedule_freq_select").value = pref.scheduler_days;
                    updateSchedulingEnabled();

                    // Bittorrent tab
                    // Privacy
                    $("dht_checkbox").checked = pref.dht;
                    $("pex_checkbox").checked = pref.pex;
                    $("lsd_checkbox").checked = pref.lsd;
                    const encryption = pref.encryption.toInt();
                    $("encryption_select").getChildren("option")[encryption].selected = true;
                    $("anonymous_mode_checkbox").checked = pref.anonymous_mode;

                    $("maxActiveCheckingTorrents").value = pref.max_active_checking_torrents;

                    // Torrent Queueing
                    $("queueing_checkbox").checked = pref.queueing_enabled;
                    $("max_active_dl_value").value = pref.max_active_downloads.toInt();
                    $("max_active_up_value").value = pref.max_active_uploads.toInt();
                    $("max_active_to_value").value = pref.max_active_torrents.toInt();
                    $("dont_count_slow_torrents_checkbox").checked = pref.dont_count_slow_torrents;
                    $("dl_rate_threshold").value = pref.slow_torrent_dl_rate_threshold.toInt();
                    $("ul_rate_threshold").value = pref.slow_torrent_ul_rate_threshold.toInt();
                    $("torrent_inactive_timer").value = pref.slow_torrent_inactive_timer.toInt();
                    updateQueueingSystem();

                    // Share Limiting
                    $("max_ratio_checkbox").checked = pref.max_ratio_enabled;
                    $("max_ratio_value").value = (pref.max_ratio_enabled ? pref.max_ratio : 1);
                    $("max_seeding_time_checkbox").checked = pref.max_seeding_time_enabled;
                    $("max_seeding_time_value").value = (pref.max_seeding_time_enabled ? pref.max_seeding_time.toInt() : 1440);
                    $("max_inactive_seeding_time_checkbox").checked = pref.max_inactive_seeding_time_enabled;
                    $("max_inactive_seeding_time_value").value = (pref.max_inactive_seeding_time_enabled ? pref.max_inactive_seeding_time.toInt() : 1440);
                    let maxRatioAct = 0;
                    switch (pref.max_ratio_act.toInt()) {
                        case 0: // Stop
                        default:
                            maxRatioAct = 0;
                            break;
                        case 1: // Remove
                            maxRatioAct = 1;
                            break;
                        case 2: // Enable super seeding
                            maxRatioAct = 3;
                            break;
                        case 3: // Remove torrent and files
                            maxRatioAct = 2;
                            break;
                    }
                    $("max_ratio_act").getChildren("option")[maxRatioAct].selected = true;
                    updateMaxRatioTimeEnabled();

                    // Add trackers
                    $("add_trackers_checkbox").checked = pref.add_trackers_enabled;
                    $("add_trackers_textarea").value = pref.add_trackers;
                    updateAddTrackersEnabled();

                    // RSS Tab
                    $("enable_fetching_rss_feeds_checkbox").checked = pref.rss_processing_enabled;
                    $("feed_refresh_interval").value = pref.rss_refresh_interval;
                    $("feedFetchDelay").value = pref.rss_fetch_delay;
                    $("maximum_article_number").value = pref.rss_max_articles_per_feed;
                    $("enable_auto_downloading_rss_torrents_checkbox").checked = pref.rss_auto_downloading_enabled;
                    $("downlock_repack_proper_episodes").checked = pref.rss_download_repack_proper_episodes;
                    $("rss_filter_textarea").value = pref.rss_smart_episode_filters;

                    // WebUI tab
                    // Language
                    updateWebuiLocaleSelect(pref.locale);
                    $("performanceWarning").checked = pref.performance_warning;

                    // HTTP Server
                    $("webui_domain_textarea").value = pref.web_ui_domain_list;
                    $("webui_address_value").value = pref.web_ui_address;
                    $("webui_port_value").value = pref.web_ui_port;
                    $("webui_upnp_checkbox").checked = pref.web_ui_upnp;
                    $("use_https_checkbox").checked = pref.use_https;
                    $("ssl_cert_text").value = pref.web_ui_https_cert_path;
                    $("ssl_key_text").value = pref.web_ui_https_key_path;
                    updateHttpsSettings();

                    // Authentication
                    $("webui_username_text").value = pref.web_ui_username;
                    $("bypass_local_auth_checkbox").checked = pref.bypass_local_auth;
                    $("bypass_auth_subnet_whitelist_checkbox").checked = pref.bypass_auth_subnet_whitelist_enabled;
                    $("bypass_auth_subnet_whitelist_textarea").value = pref.bypass_auth_subnet_whitelist;
                    updateBypasssAuthSettings();
                    $("webUIMaxAuthFailCountInput").value = pref.web_ui_max_auth_fail_count.toInt();
                    $("webUIBanDurationInput").value = pref.web_ui_ban_duration.toInt();
                    $("webUISessionTimeoutInput").value = pref.web_ui_session_timeout.toInt();

                    // Use alternative WebUI
                    $("use_alt_webui_checkbox").checked = pref.alternative_webui_enabled;
                    $("webui_files_location_textarea").value = pref.alternative_webui_path;
                    updateAlternativeWebUISettings();

                    // Security
                    $("clickjacking_protection_checkbox").checked = pref.web_ui_clickjacking_protection_enabled;
                    $("csrf_protection_checkbox").checked = pref.web_ui_csrf_protection_enabled;
                    $("secureCookieCheckbox").checked = pref.web_ui_secure_cookie_enabled;
                    $("host_header_validation_checkbox").checked = pref.web_ui_host_header_validation_enabled;
                    updateHostHeaderValidationSettings();

                    // Custom HTTP headers
                    $("webUIUseCustomHTTPHeadersCheckbox").checked = pref.web_ui_use_custom_http_headers_enabled;
                    $("webUICustomHTTPHeadersTextarea").value = pref.web_ui_custom_http_headers;
                    updateWebUICustomHTTPHeadersSettings();

                    // Reverse Proxy
                    $("webUIReverseProxySupportCheckbox").checked = pref.web_ui_reverse_proxy_enabled;
                    $("webUIReverseProxiesListTextarea").value = pref.web_ui_reverse_proxies_list;
                    updateWebUIReverseProxySettings();

                    // Update my dynamic domain name
                    $("use_dyndns_checkbox").checked = pref.dyndns_enabled;
                    $("dyndns_select").value = pref.dyndns_service;
                    $("dyndns_domain_text").value = pref.dyndns_domain;
                    $("dyndns_username_text").value = pref.dyndns_username;
                    $("dyndns_password_text").value = pref.dyndns_password;
                    updateDynDnsSettings();

                    // Advanced settings
                    // qBittorrent section
                    $("resumeDataStorageType").value = pref.resume_data_storage_type;
                    $("torrentContentRemoveOption").value = pref.torrent_content_remove_option;
                    $("memoryWorkingSetLimit").value = pref.memory_working_set_limit;
                    updateNetworkInterfaces(pref.current_network_interface, pref.current_interface_name);
                    updateInterfaceAddresses(pref.current_network_interface, pref.current_interface_address);
                    $("saveResumeDataInterval").value = pref.save_resume_data_interval;
                    $("saveStatisticsInterval").value = pref.save_statistics_interval;
                    $("torrentFileSizeLimit").value = (pref.torrent_file_size_limit / 1024 / 1024);
                    document.getElementById("confirmTorrentRecheck").checked = pref.confirm_torrent_recheck;
                    $("recheckTorrentsOnCompletion").checked = pref.recheck_completed_torrents;
                    $("appInstanceName").value = pref.app_instance_name;
                    $("refreshInterval").value = pref.refresh_interval;
                    $("resolvePeerCountries").checked = pref.resolve_peer_countries;
                    $("reannounceWhenAddressChanged").checked = pref.reannounce_when_address_changed;
                    // libtorrent section
                    $("bdecodeDepthLimit").value = pref.bdecode_depth_limit;
                    $("bdecodeTokenLimit").value = pref.bdecode_token_limit;
                    $("asyncIOThreads").value = pref.async_io_threads;
                    $("hashingThreads").value = pref.hashing_threads;
                    $("filePoolSize").value = pref.file_pool_size;
                    $("outstandMemoryWhenCheckingTorrents").value = pref.checking_memory_use;
                    $("diskCache").value = pref.disk_cache;
                    $("diskCacheExpiryInterval").value = pref.disk_cache_ttl;
                    $("diskQueueSize").value = (pref.disk_queue_size / 1024);
                    $("diskIOType").value = pref.disk_io_type;
                    $("diskIOReadMode").value = pref.disk_io_read_mode;
                    $("diskIOWriteMode").value = pref.disk_io_write_mode;
                    $("coalesceReadsAndWrites").checked = pref.enable_coalesce_read_write;
                    $("pieceExtentAffinity").checked = pref.enable_piece_extent_affinity;
                    $("sendUploadPieceSuggestions").checked = pref.enable_upload_suggestions;
                    $("sendBufferWatermark").value = pref.send_buffer_watermark;
                    $("sendBufferLowWatermark").value = pref.send_buffer_low_watermark;
                    $("sendBufferWatermarkFactor").value = pref.send_buffer_watermark_factor;
                    $("connectionSpeed").value = pref.connection_speed;
                    $("socketSendBufferSize").value = (pref.socket_send_buffer_size / 1024);
                    $("socketReceiveBufferSize").value = (pref.socket_receive_buffer_size / 1024);
                    $("socketBacklogSize").value = pref.socket_backlog_size;
                    $("outgoingPortsMin").value = pref.outgoing_ports_min;
                    $("outgoingPortsMax").value = pref.outgoing_ports_max;
                    $("UPnPLeaseDuration").value = pref.upnp_lease_duration;
                    $("peerToS").value = pref.peer_tos;
                    $("utpTCPMixedModeAlgorithm").value = pref.utp_tcp_mixed_mode;
                    $("IDNSupportCheckbox").checked = pref.idn_support_enabled;
                    $("allowMultipleConnectionsFromTheSameIPAddress").checked = pref.enable_multi_connections_from_same_ip;
                    $("validateHTTPSTrackerCertificate").checked = pref.validate_https_tracker_certificate;
                    $("mitigateSSRF").checked = pref.ssrf_mitigation;
                    $("blockPeersOnPrivilegedPorts").checked = pref.block_peers_on_privileged_ports;
                    $("enableEmbeddedTracker").checked = pref.enable_embedded_tracker;
                    $("embeddedTrackerPort").value = pref.embedded_tracker_port;
                    $("embeddedTrackerPortForwarding").checked = pref.embedded_tracker_port_forwarding;
                    $("markOfTheWeb").checked = pref.mark_of_the_web;
                    $("pythonExecutablePath").value = pref.python_executable_path;
                    $("uploadSlotsBehavior").value = pref.upload_slots_behavior;
                    $("uploadChokingAlgorithm").value = pref.upload_choking_algorithm;
                    $("announceAllTrackers").checked = pref.announce_to_all_trackers;
                    $("announceAllTiers").checked = pref.announce_to_all_tiers;
                    $("announceIP").value = pref.announce_ip;
                    $("maxConcurrentHTTPAnnounces").value = pref.max_concurrent_http_announces;
                    $("stopTrackerTimeout").value = pref.stop_tracker_timeout;
                    $("peerTurnover").value = pref.peer_turnover;
                    $("peerTurnoverCutoff").value = pref.peer_turnover_cutoff;
                    $("peerTurnoverInterval").value = pref.peer_turnover_interval;
                    $("requestQueueSize").value = pref.request_queue_size;
                    $("dhtBootstrapNodes").value = pref.dht_bootstrap_nodes;
                    $("i2pInboundQuantity").value = pref.i2p_inbound_quantity;
                    $("i2pOutboundQuantity").value = pref.i2p_outbound_quantity;
                    $("i2pInboundLength").value = pref.i2p_inbound_length;
                    $("i2pOutboundLength").value = pref.i2p_outbound_length;
                }
            });
        };

        const applyPreferences = function() {
            const settings = {};
            // Validate form data

            // Behavior tab
            LocalPreferences.set("full_url_tracker_column", document.getElementById("displayFullURLTrackerColumn").checked.toString());
            LocalPreferences.set("hide_zero_status_filters", document.getElementById("hideZeroFiltersCheckbox").checked.toString());
            LocalPreferences.set("dblclick_download", $("dblclickDownloadSelect").value);
            LocalPreferences.set("dblclick_complete", $("dblclickCompleteSelect").value);
            settings["confirm_torrent_deletion"] = document.getElementById("confirmTorrentDeletion").checked;
            LocalPreferences.set("use_alt_row_colors", document.getElementById("useAltRowColorsInput").checked.toString());
            settings["file_log_enabled"] = $("filelog_checkbox").checked;
            settings["file_log_path"] = $("filelog_save_path_input").value;
            settings["file_log_backup_enabled"] = $("filelog_backup_checkbox").checked;
            settings["file_log_max_size"] = Number($("filelog_max_size_input").value);
            settings["file_log_delete_old"] = $("filelog_delete_old_checkbox").checked;
            settings["file_log_age"] = Number($("filelog_age_input").value);
            settings["file_log_age_type"] = Number($("filelog_age_type_select").value);

            // Downloads tab
            // When adding a torrent
            settings["torrent_content_layout"] = $("contentlayout_select").getSelected()[0].value;
            settings["add_to_top_of_queue"] = $("addToTopOfQueueCheckbox").checked;
            settings["add_stopped_enabled"] = $("dontstartdownloads_checkbox").checked;
            settings["torrent_stop_condition"] = $("stopConditionSelect").getSelected()[0].value;
            settings["merge_trackers"] = document.getElementById("mergeTrackersInput").checked;
            settings["auto_delete_mode"] = Number($("deletetorrentfileafter_checkbox").checked);

            settings["preallocate_all"] = $("preallocateall_checkbox").checked;
            settings["incomplete_files_ext"] = $("appendext_checkbox").checked;
            settings["use_unwanted_folder"] = $("unwantedfolder_checkbox").checked;

            // Saving Management
            settings["auto_tmm_enabled"] = ($("default_tmm_combobox").value === "true");
            settings["torrent_changed_tmm_enabled"] = ($("torrent_changed_tmm_combobox").value === "true");
            settings["save_path_changed_tmm_enabled"] = ($("save_path_changed_tmm_combobox").value === "true");
            settings["category_changed_tmm_enabled"] = ($("category_changed_tmm_combobox").value === "true");
            settings["use_subcategories"] = $("use_subcategories_checkbox").checked;
            settings["use_category_paths_in_manual_mode"] = document.getElementById("categoryPathsManualModeCheckbox").checked;
            settings["save_path"] = $("savepath_text").value;
            settings["temp_path_enabled"] = $("temppath_checkbox").checked;
            settings["temp_path"] = $("temppath_text").value;
            if ($("exportdir_checkbox").checked)
                settings["export_dir"] = $("exportdir_text").value;
            else
                settings["export_dir"] = "";
            if ($("exportdirfin_checkbox").checked)
                settings["export_dir_fin"] = $("exportdirfin_text").value;
            else
                settings["export_dir_fin"] = "";

            // Automatically add torrents from
            settings["scan_dirs"] = getWatchedFolders();

            // Excluded file names
            settings["excluded_file_names_enabled"] = $("excludedFileNamesCheckbox").checked;
            settings["excluded_file_names"] = $("excludedFileNamesTextarea").value;

            // Email notification upon download completion
            settings["mail_notification_enabled"] = $("mail_notification_checkbox").checked;
            settings["mail_notification_sender"] = $("src_email_txt").value;
            settings["mail_notification_email"] = $("dest_email_txt").value;
            settings["mail_notification_smtp"] = $("smtp_server_txt").value;
            settings["mail_notification_ssl_enabled"] = $("mail_ssl_checkbox").checked;
            settings["mail_notification_auth_enabled"] = $("mail_auth_checkbox").checked;
            settings["mail_notification_username"] = $("mail_username_text").value;
            settings["mail_notification_password"] = $("mail_password_text").value;

            // Run an external program on torrent added
            settings["autorun_on_torrent_added_enabled"] = $("autorunOnTorrentAddedCheckbox").checked;
            settings["autorun_on_torrent_added_program"] = $("autorunOnTorrentAddedProgram").value;
            // Run an external program on torrent finished
            settings["autorun_enabled"] = $("autorun_checkbox").checked;
            settings["autorun_program"] = $("autorunProg_txt").value;

            // Connection tab
            // Listening Port
            const listen_port = $("port_value").value.toInt();
            if (isNaN(listen_port) || (listen_port < 0) || (listen_port > 65535)) {
                alert("The port used for incoming connections must be between 0 and 65535.");
                return;
            }
            settings["listen_port"] = listen_port;
            settings["upnp"] = $("upnp_checkbox").checked;

            // Connections Limits
            let max_connec = -1;
            if ($("max_connec_checkbox").checked) {
                max_connec = $("max_connec_value").value.toInt();
                if (isNaN(max_connec) || (max_connec <= 0)) {
                    alert("Maximum number of connections limit must be greater than 0 or disabled.");
                    return;
                }
            }
            settings["max_connec"] = max_connec;
            let max_connec_per_torrent = -1;
            if ($("max_connec_per_torrent_checkbox").checked) {
                max_connec_per_torrent = $("max_connec_per_torrent_value").value.toInt();
                if (isNaN(max_connec_per_torrent) || (max_connec_per_torrent <= 0)) {
                    alert("Maximum number of connections per torrent limit must be greater than 0 or disabled.");
                    return;
                }
            }
            settings["max_connec_per_torrent"] = max_connec_per_torrent;
            let max_uploads = -1;
            if ($("max_uploads_checkbox").checked) {
                max_uploads = $("max_uploads_value").value.toInt();
                if (isNaN(max_uploads) || (max_uploads <= 0)) {
                    alert("Global number of upload slots limit must be greater than 0 or disabled.");
                    return;
                }
            }
            settings["max_uploads"] = max_uploads;
            let max_uploads_per_torrent = -1;
            if ($("max_uploads_per_torrent_checkbox").checked) {
                max_uploads_per_torrent = $("max_uploads_per_torrent_value").value.toInt();
                if (isNaN(max_uploads_per_torrent) || (max_uploads_per_torrent <= 0)) {
                    alert("Maximum number of upload slots per torrent limit must be greater than 0 or disabled.");
                    return;
                }
            }
            settings["max_uploads_per_torrent"] = max_uploads_per_torrent;

            // I2P
            settings["i2p_enabled"] = $("i2pEnabledCheckbox").checked;
            settings["i2p_address"] = $("i2pAddress").value;
            settings["i2p_port"] = $("i2pPort").value.toInt();
            settings["i2p_mixed_mode"] = $("i2pMixedMode").checked;

            // Proxy Server
            settings["proxy_type"] = $("peer_proxy_type_select").value;
            settings["proxy_ip"] = $("peer_proxy_host_text").value;
            settings["proxy_port"] = $("peer_proxy_port_value").value.toInt();
            settings["proxy_auth_enabled"] = $("peer_proxy_auth_checkbox").checked;
            settings["proxy_username"] = $("peer_proxy_username_text").value;
            settings["proxy_password"] = $("peer_proxy_password_text").value;
            settings["proxy_hostname_lookup"] = $("proxyHostnameLookupCheckbox").checked;
            settings["proxy_bittorrent"] = $("proxy_bittorrent_checkbox").checked;
            settings["proxy_peer_connections"] = $("use_peer_proxy_checkbox").checked;
            settings["proxy_rss"] = $("proxy_rss_checkbox").checked;
            settings["proxy_misc"] = $("proxy_misc_checkbox").checked;

            // IP Filtering
            settings["ip_filter_enabled"] = $("ipfilter_text_checkbox").checked;
            settings["ip_filter_path"] = $("ipfilter_text").value;
            settings["ip_filter_trackers"] = $("ipfilter_trackers_checkbox").checked;
            settings["banned_IPs"] = $("banned_IPs_textarea").value;

            // Speed tab
            // Global Rate Limits
            const up_limit = $("up_limit_value").value.toInt() * 1024;
            if (isNaN(up_limit) || (up_limit < 0)) {
                alert("Global upload rate limit must be greater than 0 or disabled.");
                return;
            }
            settings["up_limit"] = up_limit;

            const dl_limit = $("dl_limit_value").value.toInt() * 1024;
            if (isNaN(dl_limit) || (dl_limit < 0)) {
                alert("Global download rate limit must be greater than 0 or disabled.");
                return;
            }
            settings["dl_limit"] = dl_limit;

            // Alternative Global Rate Limits
            const alt_up_limit = $("alt_up_limit_value").value.toInt() * 1024;
            if (isNaN(alt_up_limit) || (alt_up_limit < 0)) {
                alert("Alternative upload rate limit must be greater than 0 or disabled.");
                return;
            }
            settings["alt_up_limit"] = alt_up_limit;

            const alt_dl_limit = $("alt_dl_limit_value").value.toInt() * 1024;
            if (isNaN(alt_dl_limit) || (alt_dl_limit < 0)) {
                alert("Alternative download rate limit must be greater than 0 or disabled.");
                return;
            }
            settings["alt_dl_limit"] = alt_dl_limit;

            settings["bittorrent_protocol"] = Number($("enable_protocol_combobox").value);
            settings["limit_utp_rate"] = $("limit_utp_rate_checkbox").checked;
            settings["limit_tcp_overhead"] = $("limit_tcp_overhead_checkbox").checked;
            settings["limit_lan_peers"] = $("limit_lan_peers_checkbox").checked;

            // Scheduler
            const scheduling_enabled = $("limitSchedulingCheckbox").checked;
            settings["scheduler_enabled"] = scheduling_enabled;
            if (scheduling_enabled) {
                settings["schedule_from_hour"] = $("schedule_from_hour").value.toInt();
                settings["schedule_from_min"] = $("schedule_from_min").value.toInt();
                settings["schedule_to_hour"] = $("schedule_to_hour").value.toInt();
                settings["schedule_to_min"] = $("schedule_to_min").value.toInt();
                settings["scheduler_days"] = $("schedule_freq_select").value.toInt();
            }

            // Bittorrent tab
            // Privacy
            settings["dht"] = $("dht_checkbox").checked;
            settings["pex"] = $("pex_checkbox").checked;
            settings["lsd"] = $("lsd_checkbox").checked;
            settings["encryption"] = Number($("encryption_select").getSelected()[0].value);
            settings["anonymous_mode"] = $("anonymous_mode_checkbox").checked;

            settings["max_active_checking_torrents"] = Number($("maxActiveCheckingTorrents").value);

            // Torrent Queueing
            settings["queueing_enabled"] = $("queueing_checkbox").checked;
            if ($("queueing_checkbox").checked) {
                const max_active_downloads = $("max_active_dl_value").value.toInt();
                if (isNaN(max_active_downloads) || (max_active_downloads < -1)) {
                    alert("Maximum active downloads must be greater than -1.");
                    return;
                }
                settings["max_active_downloads"] = max_active_downloads;
                const max_active_uploads = $("max_active_up_value").value.toInt();
                if (isNaN(max_active_uploads) || (max_active_uploads < -1)) {
                    alert("Maximum active uploads must be greater than -1.");
                    return;
                }
                settings["max_active_uploads"] = max_active_uploads;
                const max_active_torrents = $("max_active_to_value").value.toInt();
                if (isNaN(max_active_torrents) || (max_active_torrents < -1)) {
                    alert("Maximum active torrents must be greater than -1.");
                    return;
                }
                settings["max_active_torrents"] = max_active_torrents;
                settings["dont_count_slow_torrents"] = $("dont_count_slow_torrents_checkbox").checked;
                const dl_rate_threshold = $("dl_rate_threshold").value.toInt();
                if (isNaN(dl_rate_threshold) || (dl_rate_threshold < 1)) {
                    alert("Download rate threshold must be greater than 0.");
                    return;
                }
                settings["slow_torrent_dl_rate_threshold"] = dl_rate_threshold;
                const ul_rate_threshold = $("ul_rate_threshold").value.toInt();
                if (isNaN(ul_rate_threshold) || (ul_rate_threshold < 1)) {
                    alert("Upload rate threshold must be greater than 0.");
                    return;
                }
                settings["slow_torrent_ul_rate_threshold"] = ul_rate_threshold;
                const torrent_inactive_timer = $("torrent_inactive_timer").value.toInt();
                if (isNaN(torrent_inactive_timer) || (torrent_inactive_timer < 1)) {
                    alert("Torrent inactivity timer must be greater than 0.");
                    return;
                }
                settings["slow_torrent_inactive_timer"] = torrent_inactive_timer;
            }

            // Share Ratio Limiting
            let max_ratio = -1;
            if ($("max_ratio_checkbox").checked) {
                max_ratio = $("max_ratio_value").value.toFloat();
                if (isNaN(max_ratio) || (max_ratio < 0) || (max_ratio > 9998)) {
                    alert("Share ratio limit must be between 0 and 9998.");
                    return;
                }
            }
            settings["max_ratio_enabled"] = $("max_ratio_checkbox").checked;
            settings["max_ratio"] = max_ratio;

            let max_seeding_time = -1;
            if ($("max_seeding_time_checkbox").checked) {
                max_seeding_time = $("max_seeding_time_value").value.toInt();
                if (isNaN(max_seeding_time) || (max_seeding_time < 0) || (max_seeding_time > 525600)) {
                    alert("Seeding time limit must be between 0 and 525600 minutes.");
                    return;
                }
            }
            settings["max_seeding_time_enabled"] = $("max_seeding_time_checkbox").checked;
            settings["max_seeding_time"] = max_seeding_time;
            settings["max_ratio_act"] = $("max_ratio_act").value.toInt();

            let max_inactive_seeding_time = -1;
            if ($("max_inactive_seeding_time_checkbox").checked) {
                max_inactive_seeding_time = $("max_inactive_seeding_time_value").value.toInt();
                if (isNaN(max_inactive_seeding_time) || (max_inactive_seeding_time < 0) || (max_inactive_seeding_time > 525600)) {
                    alert("Seeding time limit must be between 0 and 525600 minutes.");
                    return;
                }
            }
            settings["max_inactive_seeding_time_enabled"] = $("max_inactive_seeding_time_checkbox").checked;
            settings["max_inactive_seeding_time"] = max_inactive_seeding_time;
            settings["max_ratio_act"] = $("max_ratio_act").value.toInt();

            // Add trackers
            settings["add_trackers_enabled"] = $("add_trackers_checkbox").checked;
            settings["add_trackers"] = $("add_trackers_textarea").value;

            // RSS Tab
            settings["rss_processing_enabled"] = $("enable_fetching_rss_feeds_checkbox").checked;
            settings["rss_refresh_interval"] = Number($("feed_refresh_interval").value);
            settings["rss_fetch_delay"] = Number($("feedFetchDelay").value);
            settings["rss_max_articles_per_feed"] = Number($("maximum_article_number").value);
            settings["rss_auto_downloading_enabled"] = $("enable_auto_downloading_rss_torrents_checkbox").checked;
            settings["rss_download_repack_proper_episodes"] = $("downlock_repack_proper_episodes").checked;
            settings["rss_smart_episode_filters"] = $("rss_filter_textarea").value;

            // WebUI tab
            // Language
            settings["locale"] = $("locale_select").value;
            settings["performance_warning"] = $("performanceWarning").checked;

            // HTTP Server
            settings["web_ui_domain_list"] = $("webui_domain_textarea").value;
            const web_ui_address = $("webui_address_value").value.toString();
            const web_ui_port = $("webui_port_value").value.toInt();
            if (isNaN(web_ui_port) || (web_ui_port < 1) || (web_ui_port > 65535)) {
                alert("The port used for the WebUI must be between 1 and 65535.");
                return;
            }
            settings["web_ui_address"] = web_ui_address;
            settings["web_ui_port"] = web_ui_port;
            settings["web_ui_upnp"] = $("webui_upnp_checkbox").checked;

            const useHTTPS = $("use_https_checkbox").checked;
            settings["use_https"] = useHTTPS;

            const httpsCertificate = $("ssl_cert_text").value;
            settings["web_ui_https_cert_path"] = httpsCertificate;
            if (useHTTPS && (httpsCertificate.length === 0)) {
                alert("HTTPS certificate should not be empty");
                return;
            }

            const httpsKey = $("ssl_key_text").value;
            settings["web_ui_https_key_path"] = httpsKey;
            if (useHTTPS && (httpsKey.length === 0)) {
                alert("HTTPS key should not be empty");
                return;
            }

            // Authentication
            const web_ui_username = $("webui_username_text").value;
            if (web_ui_username.length < 3) {
                alert("The WebUI username must be at least 3 characters long.");
                return;
            }
            const web_ui_password = $("webui_password_text").value;
            if ((0 < web_ui_password.length) && (web_ui_password.length < 6)) {
                alert("The WebUI password must be at least 6 characters long.");
                return;
            }

            settings["web_ui_username"] = web_ui_username;
            if (web_ui_password.length > 0)
                settings["web_ui_password"] = web_ui_password;
            settings["bypass_local_auth"] = $("bypass_local_auth_checkbox").checked;
            settings["bypass_auth_subnet_whitelist_enabled"] = $("bypass_auth_subnet_whitelist_checkbox").checked;
            settings["bypass_auth_subnet_whitelist"] = $("bypass_auth_subnet_whitelist_textarea").value;
            settings["web_ui_max_auth_fail_count"] = Number($("webUIMaxAuthFailCountInput").value);
            settings["web_ui_ban_duration"] = Number($("webUIBanDurationInput").value);
            settings["web_ui_session_timeout"] = Number($("webUISessionTimeoutInput").value);

            // Use alternative WebUI
            const alternative_webui_enabled = $("use_alt_webui_checkbox").checked;
            const webui_files_location_textarea = $("webui_files_location_textarea").value;
            if (alternative_webui_enabled && (webui_files_location_textarea.trim() === "")) {
                alert("The alternative WebUI files location cannot be blank.");
                return;
            }
            settings["alternative_webui_enabled"] = alternative_webui_enabled;
            settings["alternative_webui_path"] = webui_files_location_textarea;

            // Security
            settings["web_ui_clickjacking_protection_enabled"] = $("clickjacking_protection_checkbox").checked;
            settings["web_ui_csrf_protection_enabled"] = $("csrf_protection_checkbox").checked;
            settings["web_ui_secure_cookie_enabled"] = $("secureCookieCheckbox").checked;
            settings["web_ui_host_header_validation_enabled"] = $("host_header_validation_checkbox").checked;

            // Custom HTTP headers
            settings["web_ui_use_custom_http_headers_enabled"] = $("webUIUseCustomHTTPHeadersCheckbox").checked;
            settings["web_ui_custom_http_headers"] = $("webUICustomHTTPHeadersTextarea").value;

            // Reverse Proxy
            settings["web_ui_reverse_proxy_enabled"] = $("webUIReverseProxySupportCheckbox").checked;
            settings["web_ui_reverse_proxies_list"] = $("webUIReverseProxiesListTextarea").value;

            // Update my dynamic domain name
            settings["dyndns_enabled"] = $("use_dyndns_checkbox").checked;
            settings["dyndns_service"] = Number($("dyndns_select").value);
            settings["dyndns_domain"] = $("dyndns_domain_text").value;
            settings["dyndns_username"] = $("dyndns_username_text").value;
            settings["dyndns_password"] = $("dyndns_password_text").value;

            // Update advanced settings
            // qBittorrent section
            settings["resume_data_storage_type"] = $("resumeDataStorageType").value;
            settings["torrent_content_remove_option"] = $("torrentContentRemoveOption").value;
            settings["memory_working_set_limit"] = Number($("memoryWorkingSetLimit").value);
            settings["current_network_interface"] = $("networkInterface").value;
            settings["current_interface_address"] = $("optionalIPAddressToBind").value;
            settings["save_resume_data_interval"] = Number($("saveResumeDataInterval").value);
            settings["save_statistics_interval"] = Number($("saveStatisticsInterval").value);
            settings["torrent_file_size_limit"] = ($("torrentFileSizeLimit").value * 1024 * 1024);
            settings["confirm_torrent_recheck"] = document.getElementById("confirmTorrentRecheck").checked;
            settings["recheck_completed_torrents"] = $("recheckTorrentsOnCompletion").checked;
            settings["app_instance_name"] = $("appInstanceName").value;
            settings["refresh_interval"] = Number($("refreshInterval").value);
            settings["resolve_peer_countries"] = $("resolvePeerCountries").checked;
            settings["reannounce_when_address_changed"] = $("reannounceWhenAddressChanged").checked;

            // libtorrent section
            settings["bdecode_depth_limit"] = Number($("bdecodeDepthLimit").value);
            settings["bdecode_token_limit"] = Number($("bdecodeTokenLimit").value);
            settings["async_io_threads"] = Number($("asyncIOThreads").value);
            settings["hashing_threads"] = Number($("hashingThreads").value);
            settings["file_pool_size"] = Number($("filePoolSize").value);
            settings["checking_memory_use"] = Number($("outstandMemoryWhenCheckingTorrents").value);
            settings["disk_cache"] = Number($("diskCache").value);
            settings["disk_cache_ttl"] = Number($("diskCacheExpiryInterval").value);
            settings["disk_queue_size"] = (Number($("diskQueueSize").value) * 1024);
            settings["disk_io_type"] = Number($("diskIOType").value);
            settings["disk_io_read_mode"] = Number($("diskIOReadMode").value);
            settings["disk_io_write_mode"] = Number($("diskIOWriteMode").value);
            settings["enable_coalesce_read_write"] = $("coalesceReadsAndWrites").checked;
            settings["enable_piece_extent_affinity"] = $("pieceExtentAffinity").checked;
            settings["enable_upload_suggestions"] = $("sendUploadPieceSuggestions").checked;
            settings["send_buffer_watermark"] = Number($("sendBufferWatermark").value);
            settings["send_buffer_low_watermark"] = Number($("sendBufferLowWatermark").value);
            settings["send_buffer_watermark_factor"] = Number($("sendBufferWatermarkFactor").value);
            settings["connection_speed"] = Number($("connectionSpeed").value);
            settings["socket_send_buffer_size"] = ($("socketSendBufferSize").value * 1024);
            settings["socket_receive_buffer_size"] = ($("socketReceiveBufferSize").value * 1024);
            settings["socket_backlog_size"] = Number($("socketBacklogSize").value);
            settings["outgoing_ports_min"] = Number($("outgoingPortsMin").value);
            settings["outgoing_ports_max"] = Number($("outgoingPortsMax").value);
            settings["upnp_lease_duration"] = Number($("UPnPLeaseDuration").value);
            settings["peer_tos"] = Number($("peerToS").value);
            settings["utp_tcp_mixed_mode"] = Number($("utpTCPMixedModeAlgorithm").value);
            settings["idn_support_enabled"] = $("IDNSupportCheckbox").checked;
            settings["enable_multi_connections_from_same_ip"] = $("allowMultipleConnectionsFromTheSameIPAddress").checked;
            settings["validate_https_tracker_certificate"] = $("validateHTTPSTrackerCertificate").checked;
            settings["ssrf_mitigation"] = $("mitigateSSRF").checked;
            settings["block_peers_on_privileged_ports"] = $("blockPeersOnPrivilegedPorts").checked;
            settings["enable_embedded_tracker"] = $("enableEmbeddedTracker").checked;
            settings["embedded_tracker_port"] = Number($("embeddedTrackerPort").value);
            settings["embedded_tracker_port_forwarding"] = $("embeddedTrackerPortForwarding").checked;
            settings["mark_of_the_web"] = $("markOfTheWeb").checked;
            settings["python_executable_path"] = $("pythonExecutablePath").value;
            settings["upload_slots_behavior"] = Number($("uploadSlotsBehavior").value);
            settings["upload_choking_algorithm"] = Number($("uploadChokingAlgorithm").value);
            settings["announce_to_all_trackers"] = $("announceAllTrackers").checked;
            settings["announce_to_all_tiers"] = $("announceAllTiers").checked;
            settings["announce_ip"] = $("announceIP").value;
            settings["max_concurrent_http_announces"] = Number($("maxConcurrentHTTPAnnounces").value);
            settings["stop_tracker_timeout"] = Number($("stopTrackerTimeout").value);
            settings["peer_turnover"] = Number($("peerTurnover").value);
            settings["peer_turnover_cutoff"] = Number($("peerTurnoverCutoff").value);
            settings["peer_turnover_interval"] = Number($("peerTurnoverInterval").value);
            settings["request_queue_size"] = Number($("requestQueueSize").value);
            settings["dht_bootstrap_nodes"] = $("dhtBootstrapNodes").value;
            settings["i2p_inbound_quantity"] = Number($("i2pInboundQuantity").value);
            settings["i2p_outbound_quantity"] = Number($("i2pOutboundQuantity").value);
            settings["i2p_inbound_length"] = Number($("i2pInboundLength").value);
            settings["i2p_outbound_length"] = Number($("i2pOutboundLength").value);

            // Send it to qBT
            window.parent.qBittorrent.Cache.preferences.set({
                data: settings,
                onFailure: function() {
                    alert("Unable to save program preferences, qBittorrent is probably unreachable.");
                    window.parent.qBittorrent.Client.closeWindows();
                },
                onSuccess: function() {
                    // Close window
                    window.parent.location.reload();
                    window.parent.qBittorrent.Client.closeWindows();
                }
            });
        };

        const setup = () => {
            watchedFoldersTable = new HtmlTable($("watched_folders_tab"));

            const buildInfo = window.qBittorrent.Cache.buildInfo.get();

            // hide entries
            const libtorrentVersion = window.qBittorrent.Misc.parseVersion(buildInfo.libtorrent);
            if (libtorrentVersion.valid) {
                if (libtorrentVersion.major >= 2) {
                    $("rowDiskCache").style.display = "none";
                    $("rowDiskCacheExpiryInterval").style.display = "none";
                    $("rowCoalesceReadsAndWrites").style.display = "none";
                }
                else {
                    $("fieldsetI2p").style.display = "none";
                    $("rowMemoryWorkingSetLimit").style.display = "none";
                    $("rowHashingThreads").style.display = "none";
                    $("rowDiskIOType").style.display = "none";
                    $("rowI2pInboundQuantity").style.display = "none";
                    $("rowI2pOutboundQuantity").style.display = "none";
                    $("rowI2pInboundLength").style.display = "none";
                    $("rowI2pOutboundLength").style.display = "none";
                }

                if (!((libtorrentVersion.major >= 2) && (libtorrentVersion.minor >= 0) && (libtorrentVersion.fix >= 6)))
                    $("diskIOWriteModeWriteThrough").style.display = "none";
            }

            if ((buildInfo.platform !== "macos") && (buildInfo.platform !== "windows"))
                $("rowMarkOfTheWeb").style.display = "none";

            $("networkInterface").addEventListener("change", function() {
                updateInterfaceAddresses($(this).value, "");
            });

            loadPreferences();

            window.qBittorrent.pathAutofill.attachPathAutofill();
        };

        return exports();
    })();
    Object.freeze(window.qBittorrent.Preferences);

    window.qBittorrent.Preferences.setup();
</script>
